<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>The labelled_spss_survey class</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">The labelled_spss_survey class</h1>



<p>Large international survey programs that provide data access to their
data, such as the aforementioned Eurobarometer, Afrobarometer and Arab
Barometer, or the European Values Survey, or Lationbarometro usually
give access to the data in SPSS files. In some cases, Stata files are
available, too. Our examples always start with SPSS files.</p>
<p>In R, the <a href="https://haven.tidyverse.org/">haven</a> package
provides functions to import and export data to and from IBM’s
proprietary SPSS files. We had to realize that while <a href="https://haven.tidyverse.org/reference/read_spss.html">haven::read_spss</a>
works perfectly with importing the data and metadata of a single survey,
it is not always suitable for multiple survey files, for two important
reasons. SPSS files contain the survey data in a coded form, with the
coding (labelling) metadata optionally included to each variable.</p>
<ol style="list-style-type: decimal">
<li><p>Variables imported with inconsistent labelling cannot always be
concatenated. For example, unlabelled age variables are imported to an R
numeric vector, whilst when the age 18 is labelled <em>18 years</em> or
<em>18 éves</em>, it is imported to a labelled class.</p></li>
<li><p>The SPSS variables do not handle various missing cases in a
complete and unambiguous form. In an age variable, <em>998</em> and
<em>999</em> may be labelled as <em>not asked</em> and <em>declined to
answer</em>, or simply the numerical range between 120-999 may be marked
as a range of numeric values representing missing cases.</p></li>
</ol>
<p>One practical problem in the Eurobarometer surveys, which targets the
population of at least 15 years old Europeans is that in some standard
questions, such as the age of finishing full-time education, 10
represents a special missing value, whilst in other surveys it may be a
perfectly valid numerical answer. The real coding problem is that SPSS
users can freely chose to use explicit labelling of missing cases, using
a numerical range for missing cases, or not providing any missing case
metadata at all.</p>
<p>Our importing functions rely on two new S3 classes. A single survey
is imported into a <code>survey()</code> class, which inherits all the
properties of a modern data frame, i.e., it is a <code>tibble</code> or
<code>tbl_df</code> from <a href="https://tibble.tidyverse.org/">tibble</a> in the tidyverse, but it
includes as much metadata from the original SPSS file as possible. These
metadata attributes are handled in a way that they can facilitate proper
documentation and a reproducible workflow. Furthermore, it converts
labelled variables into the <em>retroharmonize_labelled_spss</em> class
inherited from <a href="https://haven.tidyverse.org/reference/labelled_spss.html">haven::labelled_spss</a>
with more consistent handling of missing value ranges and labels. See
<code>?labelled_spss_survey</code>.</p>
<p>Working with our new <em>retroharmonize_labelled_spss class</em> can
be very cumbersome, particularly with simple harmonization tasks. In the
case of harmonizing a single question from two surveys, this may not be
practical, and a simple crosswalk table can help with spotting and
correcting inconsistent codes.</p>
<p>Our survey objects or retroharmonize_labelled_spss vectors can be
converted to base R classes with the <code>as_numeric()</code>,
<code>as_factor(</code>) or <code>as_character()</code> methods. When
computing a numerical average, the special age value of 10 is converted
to <code>NA_real</code>_ as a numeric. In other statistical
applications, missing and special values are best represented as
categories—this calls for the factor representation. The character
representation is often more useful for visualizing the data then the
factor representation.</p>
<div id="create-a-labelled_spss_survey-vector" class="section level2">
<h2>Create A labelled_spss_survey Vector</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(retroharmonize)</span></code></pre></div>
<p>Use the <code>labelled_spss_survey()</code> helper function to create
vectors of class <em>retroharmonize_labelled_spss_survey</em>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>sl1 <span class="ot">&lt;-</span> <span class="fu">labelled_spss_survey</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>),</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="st">&quot;yes&quot;</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="st">&quot;no&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="st">&quot;declined&quot;</span> <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  ),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">&quot;Do you agree?&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">na_values =</span> <span class="dv">8</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;survey1&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="fu">print</span>(sl1)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; Survey ID: survey1</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; &lt;[6]&gt;: Do you agree?</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; 1 1 0 8 8 8</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; Missing values: 8</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; See all attributes survey1_name, survey1_values, survey1_label [...], survey1_na_values with attributes(x)</span></span></code></pre></div>
<p>You can check the type:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">is.labelled_spss_survey</span>(sl1)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The <code>labelled_spss_survey()</code> class inherits some
properties from <code>haven::labelled()</code>, which can be manipulated
by the <code>labelled</code> package (See particularly the vignette
<em>Introduction to labelled</em> by Joseph Larmarange.)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>haven<span class="sc">::</span><span class="fu">is.labelled</span>(sl1)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">val_labels</span>(sl1)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;      yes       no declined </span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;        1        0        8</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">na_values</span>(sl1)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>It can also be subsetted:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>sl1[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Survey ID: survey1</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; &lt;[2]&gt;: Do you agree?</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; 0 8</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; Missing values: 8</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; See all attributes survey1_name, survey1_values, survey1_label [...], survey1_na_values with attributes(x)</span></span></code></pre></div>
<p>When used within the modernized version of <em>data.frame</em>,
<code>tibble::tibble()</code>, the summary of the variable content
prints in an informative way.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">v1 =</span> sl1)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## Use tibble instead of data.frame(v1=sl1) ...</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">print</span>(df)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 1</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;   v1               </span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;   &lt;retroh_dbl&gt;     </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 1 1 [yes]          </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 2 1 [yes]          </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; 3 0 [no]           </span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; 4 8 (NA) [declined]</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; 5 8 (NA) [declined]</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 6 8 (NA) [declined]</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="do">## ... which inherits the methods of a data.frame</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="fu">subset</span>(df, v1 <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 1</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;   v1          </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;   &lt;retroh_dbl&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; 1 1 [yes]     </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; 2 1 [yes]</span></span></code></pre></div>
</div>
<div id="coercion-rules-and-type-casting" class="section level2">
<h2>Coercion rules and type casting</h2>
<p>To avoid any confusion with mis-labelled surveys, coercion with
double or integer vectors will result in a double or integer vector. The
use of <code>vctrs::vec_c</code> is generally safer than base R
<code>c()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># double</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">c</span>(sl1, <span class="dv">1</span> <span class="sc">/</span> <span class="dv">7</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; [1] 1.0000000 1.0000000 0.0000000 8.0000000 8.0000000 8.0000000 0.1428571</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>vctrs<span class="sc">::</span><span class="fu">vec_c</span>(sl1, <span class="dv">1</span> <span class="sc">/</span> <span class="dv">7</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; [1] 1.0000000 1.0000000 0.0000000 8.0000000 8.0000000 8.0000000 0.1428571</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">c</span>(sl1, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; [1] 1 1 0 8 8 8 1 2 3</span></span></code></pre></div>
<p>Conversion to character works as expected:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">as.character</span>(sl1)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1&quot; &quot;1&quot; &quot;0&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot;</span></span></code></pre></div>
<p>The base <code>as.factor</code> converts to integer and uses the
integers as levels, because base R factors are integers with a
<code>levels</code> attribute.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">as.factor</span>(sl1)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; [1] 1 1 0 8 8 8</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; Levels: 0 1 8</span></span></code></pre></div>
<p>Conversion to factor with <code>as_factor</code> converts the value
labels to factor levels:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">as_factor</span>(sl1)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; [1] yes      yes      no       declined declined declined</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;label&quot;)</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; [1] Do you agree?</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; Levels: no yes declined</span></span></code></pre></div>
<p>Similarly, when converting to numeric types, we have to convert the
user-defined missing values to <code>NA</code> values used in the R
language. For numerical analysis, convert with
<code>as_numeric</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">as.numeric</span>(sl1)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; [1] 1 1 0 8 8 8</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">as_numeric</span>(sl1)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; [1]  1  1  0 NA NA NA</span></span></code></pre></div>
</div>
<div id="arithmetics" class="section level2">
<h2>Arithmetics</h2>
<p>The median value is correctly displayed, because user-defined missing
values are removed from the calculation. Only a few arithmetic methods
are implemented, such as</p>
<ul>
<li>median()</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">median</span>(<span class="fu">as.numeric</span>(sl1))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; [1] 4.5</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">median</span>(sl1)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<ul>
<li>quantile()</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">quantile</span>(<span class="fu">as.numeric</span>(sl1), <span class="fl">0.9</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; 90% </span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt;   8</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">quantile</span>(sl1, <span class="fl">0.9</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; 90% </span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;   1</span></span></code></pre></div>
<ul>
<li>mean()</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">as.numeric</span>(sl1))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt; [1] 4.333333</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">mean</span>(sl1)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">mean</span>(sl1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; [1] 0.6666667</span></span></code></pre></div>
<ul>
<li>weighted.mean() - always removes NA values.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>weights1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(sl1), weights1)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co">#&gt; [1] 5.057185</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">weighted.mean</span>(sl1, weights1)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt; [1] 0.4838951</span></span></code></pre></div>
<ul>
<li>sum()</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">as.numeric</span>(sl1))</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; [1] 26</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="fu">sum</span>(sl1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>The result of the conversion to numeric can be used for other
mathematical / statistical function.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">as_numeric</span>(sl1)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; [1]  1  1  0 NA NA NA</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">as_numeric</span>(sl1))</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">as_numeric</span>(sl1), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
