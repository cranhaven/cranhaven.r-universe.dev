<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Working with a Crosswalk Table</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Working with a Crosswalk Table</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(retroharmonize)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Let’s read in the package’s small examples, and create a metadata
table from them. These steps were explained in the vignette <a href="https://retroharmonize.dataobservatory.eu/articles/metadata.html">Working
With Survey Metadata</a>.</p>
<p>From a technical perspective, the aim of the survey harmonization is
to create a single, tidy, joined table in the form of a data frame that
contains a row identifier, which is truly unique across all observations
and the concatenated and harmonized variables.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>examples_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="at">package =</span> <span class="st">&quot;retroharmonize&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>survey_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(examples_dir)[<span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.rds&quot;</span>, <span class="fu">dir</span>(examples_dir))]</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>survey_files</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ZA5913.rds&quot; &quot;ZA6863.rds&quot; &quot;ZA7576.rds&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>survey_paths <span class="ot">&lt;-</span> <span class="fu">file.path</span>(examples_dir, survey_files)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>example_metadata <span class="ot">&lt;-</span> <span class="fu">metadata_create</span>(<span class="at">survey_paths =</span> survey_paths)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; Read: C:/Users/DanielAntal/AppData/Local/Temp/RtmpYD7zvY/Rinst742c5d3c5684/retroharmonize/examples/ZA5913.rds</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; Read: C:/Users/DanielAntal/AppData/Local/Temp/RtmpYD7zvY/Rinst742c5d3c5684/retroharmonize/examples/ZA6863.rds</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; Read: C:/Users/DanielAntal/AppData/Local/Temp/RtmpYD7zvY/Rinst742c5d3c5684/retroharmonize/examples/ZA7576.rds</span></span></code></pre></div>
<div id="crosswalk-table" class="section level2">
<h2>Crosswalk Table</h2>
<p>A schema crosswalk, or a crosswalk table is a table that shows
equivalent elements (or “fields”) in more than one survey. In this
example, we will create a crosswalk table of a subset of the tree
example surveys. We will use three variables: the unique row identifier,
the Trust in the European Parliament concept, and the country code.</p>
<p>By filtering out the other variables, we have the basic information
in our metadata table.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>subset_example_metadata <span class="ot">&lt;-</span> example_metadata <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^unique_identifier_in|trust|country_code&quot;</span>, var_label_orig)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="st">&quot;^unique_identifier_in|european_parliament|country_code&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    var_label_orig</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">filter</span>(var_name_orig <span class="sc">!=</span> <span class="st">&quot;uniqid&quot;</span>)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>subset_example_metadata</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;     filename     id var_name_orig          class_orig</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 1 ZA5913.rds ZA5913         rowid           character</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; 2 ZA5913.rds ZA5913      isocntry           character</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; 3 ZA5913.rds ZA5913        qa10_1 haven_labelled_spss</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; 4 ZA6863.rds ZA6863         rowid           character</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; 5 ZA6863.rds ZA6863      isocntry           character</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; 6 ZA6863.rds ZA6863        qa14_1      haven_labelled</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; 7 ZA7576.rds ZA7576         rowid           character</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; 8 ZA7576.rds ZA7576      isocntry           character</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; 9 ZA7576.rds ZA7576        qa14_1 haven_labelled_spss</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt;                 var_label_orig     labels valid_labels na_labels na_range</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; 1 unique_identifier_in_za_5913         NA           NA        NA       NA</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; 2        country_code_iso_3166         NA           NA        NA       NA</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; 3    european_parliament_trust    1, 2, 3         1, 2         3       NA</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; 4 unique_identifier_in_za_6863         NA           NA        NA       NA</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; 5        country_code_iso_3166         NA           NA        NA       NA</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt; 6    european_parliament_trust    1, 2, 3      1, 2, 3                 NA</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt; 7 unique_identifier_in_za_7576         NA           NA        NA       NA</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt; 8        country_code_iso_3166         NA           NA        NA       NA</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; 9    european_parliament_trust 1, 2, 3, 9      1, 2, 3         9       NA</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt;   n_labels n_valid_labels n_na_labels</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co">#&gt; 1        0              0           0</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">#&gt; 2        0              0           0</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">#&gt; 3        3              2           1</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">#&gt; 4        0              0           0</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co">#&gt; 5        0              0           0</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="co">#&gt; 6        3              3           0</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="co">#&gt; 7        0              0           0</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="co">#&gt; 8        0              0           0</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="co">#&gt; 9        4              3           1</span></span></code></pre></div>
<div id="create-a-crosswalk-table" class="section level3">
<h3>Create a crosswalk table</h3>
<p>You can easily create a crosswalk table with
<code>crosswalk_table_create()</code>. Crosswalk tables are validated
with <code>is.crosswalk()</code>. You can create or modify your own
crosswalk table in any spreadsheet program. The mandatory elements of a
crosswalk table are</p>
<ul>
<li><code>id</code>: a unique identifier for a survey</li>
<li><code>filename</code>: the original source data file</li>
<li><code>var_name_orig</code>: the original variable name at
source</li>
<li><code>var_name_target</code>: the original variable name after using
the crosswalk, by default, it equal to <code>var_name_orig</code>.</li>
</ul>
<p>All other columns are optional because they are needed for specific
tasks, namely to change the numeric coding and labelling of valid and
special survey response values, or to harmonize the eventual R type
representation of the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>ct <span class="ot">&lt;-</span> <span class="fu">crosswalk_table_create</span>(subset_example_metadata)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>ct</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; # A tibble: 16 × 16</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt;    id     filename   var_name_orig var_name_target val_numeric_orig</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;                      &lt;dbl&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;  1 ZA5913 ZA5913.rds rowid         rowid                         NA</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;  2 ZA5913 ZA5913.rds isocntry      isocntry                      NA</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;  3 ZA5913 ZA5913.rds qa10_1        qa10_1                         1</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;  4 ZA5913 ZA5913.rds qa10_1        qa10_1                         2</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;  5 ZA5913 ZA5913.rds qa10_1        qa10_1                         3</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;  6 ZA6863 ZA6863.rds rowid         rowid                         NA</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;  7 ZA6863 ZA6863.rds isocntry      isocntry                      NA</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;  8 ZA6863 ZA6863.rds qa14_1        qa14_1                         1</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;  9 ZA6863 ZA6863.rds qa14_1        qa14_1                         2</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 10 ZA6863 ZA6863.rds qa14_1        qa14_1                         3</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 11 ZA7576 ZA7576.rds rowid         rowid                         NA</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 12 ZA7576 ZA7576.rds isocntry      isocntry                      NA</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 13 ZA7576 ZA7576.rds qa14_1        qa14_1                         1</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 14 ZA7576 ZA7576.rds qa14_1        qa14_1                         2</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 15 ZA7576 ZA7576.rds qa14_1        qa14_1                         3</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; 16 ZA7576 ZA7576.rds qa14_1        qa14_1                         9</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 11 more variables: val_numeric_target &lt;dbl&gt;, val_label_orig &lt;chr&gt;,</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; #   val_label_target &lt;chr&gt;, class_orig &lt;chr&gt;, class_target &lt;chr&gt;,</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; #   na_label_orig &lt;chr&gt;, na_label_target &lt;chr&gt;, na_numeric_orig &lt;dbl&gt;,</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; #   na_numeric_target &lt;dbl&gt;, var_label_orig &lt;chr&gt;, var_label_target &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="variable-name-harmonization" class="section level3">
<h3>Variable name harmonization</h3>
<p>The harmonization of the variable names requires a single,
unambiguous name for the variables that represent the same concept:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>ct <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_name_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    var_name_orig <span class="sc">==</span> <span class="st">&quot;rowid&quot;</span> <span class="sc">~</span> .data<span class="sc">$</span>var_name_orig,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    var_name_orig <span class="sc">==</span> <span class="st">&quot;isocntry&quot;</span> <span class="sc">~</span> <span class="st">&quot;geo&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;trust_ep&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;filename&quot;</span>, <span class="st">&quot;var_name_orig&quot;</span>, <span class="st">&quot;var_name_target&quot;</span>))))</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 9 × 3</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;   filename   var_name_orig var_name_target</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;          </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; 1 ZA5913.rds rowid         rowid          </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; 2 ZA5913.rds isocntry      geo            </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; 3 ZA5913.rds qa10_1        trust_ep       </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; 4 ZA6863.rds rowid         rowid          </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; 5 ZA6863.rds isocntry      geo            </span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; 6 ZA6863.rds qa14_1        trust_ep       </span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; 7 ZA7576.rds rowid         rowid          </span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; 8 ZA7576.rds isocntry      geo            </span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; 9 ZA7576.rds qa14_1        trust_ep</span></span></code></pre></div>
</div>
<div id="value-numeric-code-and-label-harmonization" class="section level3">
<h3>Value numeric code and label harmonization</h3>
<p>For code and label harmonization, the crosswalk table should
optionally contain instructions on harmonizing the numeric value codes
and value labels.</p>
<ul>
<li>The <code>crosswalk_table_create()</code> will create identical
source and target columns for labeling (and type setting.)</li>
<li>You can save this table into <code>.csv</code> or <code>.xls</code>
and edit it in a spreadsheet application if you want. If you do not
change the default values (<code>source</code>=<code>target</code>) then
the harmonization in those aspects will not take place.</li>
</ul>
<p>In this example, for full reproducability, we do not work in a
spreadsheet program like Excel or Numbers or OpenOffice but we create
programatically an unambiguous coding. To be on the safe side, the
special missing value is placed far away from the normal values.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>ct <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val_numeric_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> .data<span class="sc">$</span>val_numeric_orig,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">99999</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val_label_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;trust&quot;</span>,</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;distrust&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;declined&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="st">&quot;filename&quot;</span>,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="st">&quot;val_numeric_orig&quot;</span>, <span class="st">&quot;val_numeric_target&quot;</span>,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    <span class="st">&quot;val_label_orig&quot;</span>, <span class="st">&quot;val_label_target&quot;</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  ))))</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; # A tibble: 13 × 5</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt;    filename  val_numeric_orig val_numeric_target val_label_orig val_label_target</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                &lt;dbl&gt;              &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;           </span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;  1 ZA5913.r…               NA              99999 &lt;NA&gt;           declined        </span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt;  2 ZA5913.r…                1                  1 Tend to trust  trust           </span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt;  3 ZA5913.r…                2                  0 Tend not to t… distrust        </span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt;  4 ZA5913.r…                3              99999 DK             declined        </span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt;  5 ZA6863.r…               NA              99999 &lt;NA&gt;           declined        </span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt;  6 ZA6863.r…                1                  1 Tend to trust  trust           </span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt;  7 ZA6863.r…                2                  0 Tend not to t… distrust        </span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt;  8 ZA6863.r…                3              99999 DK             declined        </span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt;  9 ZA7576.r…               NA              99999 &lt;NA&gt;           declined        </span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; 10 ZA7576.r…                1                  1 Tend to trust  trust           </span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt; 11 ZA7576.r…                2                  0 Tend not to t… distrust        </span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt; 12 ZA7576.r…                3              99999 DK             declined        </span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; 13 ZA7576.r…                9              99999 Inap. (not CY… declined</span></span></code></pre></div>
<p>And now let’s turn our attention to the special (missing) cases.
Sometimes there may be other special cases in the code range, but the
most likely suspects are values that represent some form of missing
answers to a question or a missing questionnaire item selection.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>ct <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_numeric_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    na_numeric_orig <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">99999</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_label_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    na_numeric_target <span class="sc">==</span> <span class="dv">99999</span> <span class="sc">~</span> <span class="st">&quot;declined&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="st">&quot;filename&quot;</span>, <span class="st">&quot;val_numeric_orig&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    <span class="st">&quot;na_numeric_orig&quot;</span>, <span class="st">&quot;na_numeric_target&quot;</span>,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="st">&quot;na_label_orig&quot;</span>, <span class="st">&quot;na_label_target&quot;</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  ))))</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; # A tibble: 13 × 6</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;    filename   val_numeric_orig na_numeric_orig na_numeric_target na_label_orig  </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                 &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;          </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt;  1 ZA5913.rds               NA              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt;  2 ZA5913.rds                1              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt;  3 ZA5913.rds                2              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt;  4 ZA5913.rds                3               3             99999 DK             </span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt;  5 ZA6863.rds               NA              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt;  6 ZA6863.rds                1              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt;  7 ZA6863.rds                2              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt;  8 ZA6863.rds                3              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt;  9 ZA7576.rds               NA              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt; 10 ZA7576.rds                1              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt; 11 ZA7576.rds                2              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt; 12 ZA7576.rds                3              NA                NA &lt;NA&gt;           </span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt; 13 ZA7576.rds                9               9                NA Inap. (not CY-…</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: na_label_target &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="a-reproducible-recoding-and-relabelling" class="section level3">
<h3>A reproducible recoding and relabelling</h3>
<p>Let’s put the entire process into a tidyverse pipeline with <a href="https://dplyr.tidyverse.org/">dplyr</a>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>example_crosswalk_table <span class="ot">&lt;-</span> ct <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_name_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    var_name_orig <span class="sc">==</span> <span class="st">&quot;rowid&quot;</span> <span class="sc">~</span> .data<span class="sc">$</span>var_name_orig,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    var_name_orig <span class="sc">==</span> <span class="st">&quot;isocntry&quot;</span> <span class="sc">~</span> <span class="st">&quot;geo&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;trust_ep&quot;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val_numeric_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> .data<span class="sc">$</span>val_numeric_orig,</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">99999</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val_label_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;trust&quot;</span>,</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    val_numeric_orig <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;distrust&quot;</span>,</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;declined&quot;</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_numeric_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    na_numeric_orig <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">99999</span>,</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_label_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>    na_numeric_target <span class="sc">==</span> <span class="dv">99999</span> <span class="sc">~</span> <span class="st">&quot;declined&quot;</span>,</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>  ))</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>example_crosswalk_table</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt; # A tibble: 16 × 16</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt;    id     filename   var_name_orig var_name_target val_numeric_orig</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;                      &lt;dbl&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="co">#&gt;  1 ZA5913 ZA5913.rds rowid         rowid                         NA</span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co">#&gt;  2 ZA5913 ZA5913.rds isocntry      geo                           NA</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co">#&gt;  3 ZA5913 ZA5913.rds qa10_1        trust_ep                       1</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt;  4 ZA5913 ZA5913.rds qa10_1        trust_ep                       2</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt;  5 ZA5913 ZA5913.rds qa10_1        trust_ep                       3</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt;  6 ZA6863 ZA6863.rds rowid         rowid                         NA</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt;  7 ZA6863 ZA6863.rds isocntry      geo                           NA</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt;  8 ZA6863 ZA6863.rds qa14_1        trust_ep                       1</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a><span class="co">#&gt;  9 ZA6863 ZA6863.rds qa14_1        trust_ep                       2</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="co">#&gt; 10 ZA6863 ZA6863.rds qa14_1        trust_ep                       3</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="co">#&gt; 11 ZA7576 ZA7576.rds rowid         rowid                         NA</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="co">#&gt; 12 ZA7576 ZA7576.rds isocntry      geo                           NA</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a><span class="co">#&gt; 13 ZA7576 ZA7576.rds qa14_1        trust_ep                       1</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a><span class="co">#&gt; 14 ZA7576 ZA7576.rds qa14_1        trust_ep                       2</span></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a><span class="co">#&gt; 15 ZA7576 ZA7576.rds qa14_1        trust_ep                       3</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a><span class="co">#&gt; 16 ZA7576 ZA7576.rds qa14_1        trust_ep                       9</span></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a><span class="co">#&gt; # ℹ 11 more variables: val_numeric_target &lt;dbl&gt;, val_label_orig &lt;chr&gt;,</span></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a><span class="co">#&gt; #   val_label_target &lt;chr&gt;, class_orig &lt;chr&gt;, class_target &lt;chr&gt;,</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="co">#&gt; #   na_label_orig &lt;chr&gt;, na_label_target &lt;chr&gt;, na_numeric_orig &lt;dbl&gt;,</span></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a><span class="co">#&gt; #   na_numeric_target &lt;dbl&gt;, var_label_orig &lt;chr&gt;, var_label_target &lt;chr&gt;</span></span></code></pre></div>
<p>Needless to say that you do not need to work with <em>dplyr</em>.</p>
<p>Reading the crosswalk table is very simple, for example, the last two
(15-16) rows read like this:</p>
<ul>
<li>In <code>ZA6863.rds</code> rename the variable storing questionnaire
item <code>qa14_1</code> to <code>trust_ep</code>
(<code>Trust in European Parliament</code>).<br />
</li>
<li>Recode the numeric values from <code>2</code> to <code>0</code> and
label them as <code>distrust</code>.</li>
<li>Recode the special values from <code>3</code> to <code>99999</code>
and label them as <code>declined</code>.</li>
</ul>
</div>
<div id="subsetting" class="section level3">
<h3>Subsetting</h3>
<p>From a technical perspective, the aim of the survey harmonization is
to create a single, tidy, joined table. For making joining possible (and
to reduce memory use), a first processing step is to remove irrelevant
variables that will not be harmonized.</p>
<p>There are several ways how the subsetting can be made. With smaller
tasks all the surveys can be stored in memory and the subsequent
processing made fast in memory. With many surveys, we provide a slower
but memory-saving way of importing and subsetting consecutive surveys
from files.</p>
<p>Recall from the vignette <a href="https://retroharmonize.dataobservatory.eu/articles/metadata.html">Working
With Survey Metadata</a> that you can read files into a list of
surveys:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>example_surveys <span class="ot">&lt;-</span> <span class="fu">read_surveys</span>(survey_paths, <span class="at">.f =</span> <span class="st">&quot;read_rds&quot;</span>)</span></code></pre></div>
<p>Now let’s focus of our attention to a small subset of the
variables.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>subset_survey_list_1 <span class="ot">&lt;-</span> <span class="fu">subset_surveys</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">survey_list =</span> example_surveys,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">subset_vars =</span> <span class="fu">c</span>(<span class="st">&quot;rowid&quot;</span>, <span class="st">&quot;isocntry&quot;</span>, <span class="st">&quot;qa10_1&quot;</span>, <span class="st">&quot;qa14_1&quot;</span>),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">subset_name =</span> <span class="st">&quot;subset_example&quot;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>)</span></code></pre></div>
<p>We still have the three surveys in a list:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">vapply</span>(subset_survey_list_1, <span class="cf">function</span>(x) <span class="fu">attr</span>(x, <span class="st">&quot;id&quot;</span>), <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ZA5913&quot; &quot;ZA6863&quot; &quot;ZA7576&quot;</span></span></code></pre></div>
<p>The top few rows of the first subsetted survey to see if the
subsetting took place:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">head</span>(subset_survey_list_1[[<span class="dv">1</span>]])</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; Unknown (2026): Untitled Dataset [dataset]</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt;   rowid    isocntry qa10_1                </span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;dbl+lbl&gt;            </span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; 1 ZA5913_1 NL       2 [Tend not to trust]</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; 2 ZA5913_2 NL       2 [Tend not to trust]</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; 3 ZA5913_3 NL       3 (NA) [DK]          </span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; 4 ZA5913_4 NL       1 [Tend to trust]    </span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; 5 ZA5913_5 NL       1 [Tend to trust]    </span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; 6 ZA5913_6 NL       1 [Tend to trust]</span></span></code></pre></div>
<p>While <code>qa10_1</code> and <code>qa14_1</code> refer to trust in
the European Parliament, they cannot be joined because they have
dissimilar names. These names are not too easy to remember, either.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">lapply</span>(subset_survey_list_1, names)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;rowid&quot;    &quot;isocntry&quot; &quot;qa10_1&quot;  </span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;rowid&quot;    &quot;isocntry&quot; &quot;qa14_1&quot;  </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;rowid&quot;    &quot;isocntry&quot; &quot;qa14_1&quot;</span></span></code></pre></div>
<p>The next step is to harmonize the names of those variables that
represent the same concept, in this case, <em>Trust in the European
Parliament</em>. The next steps, i.e. the harmonization of the numerical
codes of answers and their labels will be discussed in the <a href="https://retroharmonize.dataobservatory.eu/articles/harmonize_labels.html">Harmonize
Value Labels</a> vignette.</p>
</div>
</div>
<div id="variable-name-harmonization-1" class="section level2">
<h2>Variable Name Harmonization</h2>
<p>It is very practical to do the subsetting and the variable name
harmonization in one step. The <code>subset_save_surveys()</code>
function will do this optionally, and a wrapper function
<code>harmonize_surveys()</code> will validate that all metadata
(i.e. the original, source variable names and the new, target variable
names) are present.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>subset_survey_list_2 <span class="ot">&lt;-</span> <span class="fu">subset_surveys</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="at">crosswalk_table =</span> example_crosswalk_table,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="at">survey_list =</span> example_surveys,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="at">subset_name =</span> <span class="st">&quot;trust_ep&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>)</span></code></pre></div>
<p>We have again the three surveys in a list:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">vapply</span>(subset_survey_list_2, <span class="cf">function</span>(x) <span class="fu">attr</span>(x, <span class="st">&quot;id&quot;</span>), <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ZA5913&quot; &quot;ZA6863&quot; &quot;ZA7576&quot;</span></span></code></pre></div>
<p>The top few rows of the first subsetted survey now show that we have
new, harmonized names.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">head</span>(subset_survey_list_2[[<span class="dv">1</span>]])</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="co">#&gt; Unknown (2026): Untitled Dataset [dataset]</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co">#&gt;   rowid    isocntry qa10_1                </span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;dbl+lbl&gt;            </span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt; 1 ZA5913_1 NL       2 [Tend not to trust]</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; 2 ZA5913_2 NL       2 [Tend not to trust]</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt; 3 ZA5913_3 NL       3 (NA) [DK]          </span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; 4 ZA5913_4 NL       1 [Tend to trust]    </span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; 5 ZA5913_5 NL       1 [Tend to trust]    </span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt; 6 ZA5913_6 NL       1 [Tend to trust]</span></span></code></pre></div>
<p>Our variable names are harmonized:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">lapply</span>(subset_survey_list_2, names)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;rowid&quot;    &quot;isocntry&quot; &quot;qa10_1&quot;  </span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;rowid&quot;    &quot;isocntry&quot; &quot;qa14_1&quot;  </span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;rowid&quot;    &quot;isocntry&quot; &quot;qa14_1&quot;</span></span></code></pre></div>
<p>While this example easily fits in the memory, when working with
several dozens of SPSS files, it is better to sequentially import the
surveys from file, and save the output to files. By default, the
parameters <code>import_path</code> and <code>export_path</code> are set
to <code>NULL</code>. If you enter a valid path to a directory, the
function will look for the files specified in the
<code>crosswalk_table$filename</code> on this path.</p>
<ul>
<li>If you do not specify the <code>export_path</code>, a list of
surveys will be returned.</li>
<li>If you specify the <code>export_path</code>, a vector of the saved
file names (with full path) will be returned.</li>
</ul>
<p>The <code>subset_surveys()</code> is a versatile function that fits
with several workflows. It works in memory or with larger tasks, with
sequentially read survey files; it for simple tasks it can use a simple
vector for names to keep, or it can use an entire crosswalk table. You
can read more about it with <code>?subset_surveys</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">subset_surveys</span>(</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="at">survey_list =</span> example_surveys,</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="at">crosswalk_table =</span> example_crosswalk_table,</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="at">subset_name =</span> <span class="st">&quot;trust_ep&quot;</span>,</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="at">import_path =</span> examples_dir,</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="at">export_path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; Saving ZA5913_trust_ep.rds</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; Saving ZA6863_trust_ep.rds</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt; Saving ZA7576_trust_ep.rds</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ZA5913_trust_ep.rds&quot; &quot;ZA6863_trust_ep.rds&quot; &quot;ZA7576_trust_ep.rds&quot;</span></span></code></pre></div>
<p>The subsetted surveys are saved with a common name element,
<code>trust_ep</code> to the export file location, in this case a
temporary directory created with <code>tempdir()</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">readRDS</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;ZA5913_trust_ep.rds&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; Unknown (2026): Untitled Dataset [dataset]</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt;   rowid    isocntry qa10_1                </span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;dbl+lbl&gt;            </span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; 1 ZA5913_1 NL       2 [Tend not to trust]</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co">#&gt; 2 ZA5913_2 NL       2 [Tend not to trust]</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt; 3 ZA5913_3 NL       3 (NA) [DK]          </span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt; 4 ZA5913_4 NL       1 [Tend to trust]    </span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt; 5 ZA5913_5 NL       1 [Tend to trust]    </span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt; 6 ZA5913_6 NL       1 [Tend to trust]</span></span></code></pre></div>
</div>
<div id="further-steps" class="section level2">
<h2>Further Steps</h2>
<p>Having a subsetted list of surveys with harmonized variable names is
usually not yet an output that is ready for statistical analysis. In the
next step, the numerical codes, the variable labels need to be made
consistent, with a special attention given to special values,
particularly to missing values.</p>
<p>At last, if the statistical analysis will take place in R, a
conversion to basic R classes is necessary to rely on the vast arsenal
of R’s statistical packages. This means that the survey data must be
brought to a consistent numeric or a consistent factor format (and in
some cases, for visualization, to a character format).</p>
<p>We created a special s3 class (see
<code>?labelled_spss_survey</code>), which retains the metadata about
coding and special values, and created three methods that take into
consideration the retained metadata. For example, if 999 is the code for
declined answers, then the base are <code>as.numeric()</code> will
coerce observations (survey responses) with a value <code>999</code> to
a numerical value of <code>999</code>, but the <code>as_numeric()</code>
method will give a <code>NA_real_</code> representation to this
observation. Averaging numerical, coded values will give a logically
wrong result with the basic as.numeric, but a correct with the
<code>as_numeric()</code> method.</p>
<p>The crosswalk table is a map for value code and label harmonization,
and for type conversion, too. This is the topic of the <a href="https://retroharmonize.dataobservatory.eu/articles/harmonize_labels.html">Harmonize
Value Labels</a> vignette.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
