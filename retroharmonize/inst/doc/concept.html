<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Harmonizing Concepts, Questions, and Variables</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Harmonizing Concepts, Questions, and
Variables</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(retroharmonize)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>The first step of retrospective harmonization is finding the relevant
concepts, operationalized in questions that need to be harmonized among
two or more surveys.</p>
<div id="concept" class="section level2">
<h2>Concept</h2>
</div>
<div id="questions" class="section level2">
<h2>Questions</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>examples_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="at">package =</span> <span class="st">&quot;retroharmonize&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>survey_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(examples_dir)[<span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.rds&quot;</span>, <span class="fu">dir</span>(examples_dir))]</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>survey_files</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ZA5913.rds&quot; &quot;ZA6863.rds&quot; &quot;ZA7576.rds&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>survey_paths <span class="ot">&lt;-</span> <span class="fu">file.path</span>(examples_dir, survey_files)</span></code></pre></div>
<p>With smaller data frames representing your surveys, the most
efficient way to work with the information is to read them into a list
of surveys.</p>
<p>Read the surveys into a list object in the memory:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>example_surveys <span class="ot">&lt;-</span> <span class="fu">read_surveys</span>(survey_paths, <span class="at">.f =</span> <span class="st">&quot;read_rds&quot;</span>)</span></code></pre></div>
<p>If you may ran out of memory, you can work with files. The advantage
of keeping the surveys in memory is that later it will be much faster to
continue working with them, but from the metadata point of view, the
returned object is the same either way.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># not evaluated</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>example_metadata <span class="ot">&lt;-</span> <span class="fu">metadata_create</span>(<span class="at">survey_paths =</span> survey_paths, <span class="at">.f =</span> <span class="st">&quot;read_rds&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; Read: C:/Users/DanielAntal/AppData/Local/Temp/RtmpYD7zvY/Rinst742c5d3c5684/retroharmonize/examples/ZA5913.rds</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; Read: C:/Users/DanielAntal/AppData/Local/Temp/RtmpYD7zvY/Rinst742c5d3c5684/retroharmonize/examples/ZA6863.rds</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; Read: C:/Users/DanielAntal/AppData/Local/Temp/RtmpYD7zvY/Rinst742c5d3c5684/retroharmonize/examples/ZA7576.rds</span></span></code></pre></div>
<p>Let’s work in the memory now. Map the metadata contents of the
files:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">metadata_create</span>(<span class="at">survey_list =</span> example_surveys) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">sample_n</span>(<span class="dv">12</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt;      filename     id var_name_orig          class_orig</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; 1  ZA6863.rds ZA6863        qa14_1      haven_labelled</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; 2  ZA6863.rds ZA6863         qd7.7      haven_labelled</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; 3  ZA5913.rds ZA5913            p1      haven_labelled</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 4  ZA7576.rds ZA7576         qd6.2 haven_labelled_spss</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; 5  ZA5913.rds ZA5913        qa10_3 haven_labelled_spss</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 6  ZA5913.rds ZA5913            p3 haven_labelled_spss</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 7  ZA7576.rds ZA7576            p1      haven_labelled</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; 8  ZA7576.rds ZA7576        qa6b_4 haven_labelled_spss</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; 9  ZA5913.rds ZA5913         rowid           character</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 10 ZA6863.rds ZA6863           d25 haven_labelled_spss</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 11 ZA5913.rds ZA5913        qd3_11      haven_labelled</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 12 ZA7576.rds ZA7576            d7      haven_labelled</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt;                              var_label_orig</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 1                 european_parliament_trust</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 2            important_values_pers_equality</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 3                         date_of_interview</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; 4  important_values_pers_respect_human_life</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; 5               european_central_bank_trust</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; 6             duration_of_interview_minutes</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; 7                         date_of_interview</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; 8           trust_in_institutions_media_tcc</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; 9              unique_identifier_in_za_5913</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; 10                        type_of_community</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt; 11    important_values_pers_self_fulfilment</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; 12                           marital_status</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt;                                                                       labels</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; 1                                                                    1, 2, 3</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; 2                                                                       0, 1</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt; 3                              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt; 4                                                                    0, 1, 9</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt; 5                                                                    1, 2, 3</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt; 6                                                                2, 225, 999</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">#&gt; 7  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co">#&gt; 8                                                                 1, 2, 3, 9</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="co">#&gt; 9                                                                         NA</span></span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a><span class="co">#&gt; 10                                                                1, 2, 3, 8</span></span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a><span class="co">#&gt; 11                                                                      0, 1</span></span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a><span class="co">#&gt; 12                     1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 97</span></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a><span class="co">#&gt;                                                                 valid_labels</span></span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a><span class="co">#&gt; 1                                                                    1, 2, 3</span></span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a><span class="co">#&gt; 2                                                                       0, 1</span></span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a><span class="co">#&gt; 3                              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14</span></span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a><span class="co">#&gt; 4                                                                       0, 1</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a><span class="co">#&gt; 5                                                                       1, 2</span></span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a><span class="co">#&gt; 6                                                                     2, 225</span></span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a><span class="co">#&gt; 7  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21</span></span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a><span class="co">#&gt; 8                                                                    1, 2, 3</span></span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a><span class="co">#&gt; 9                                                                         NA</span></span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a><span class="co">#&gt; 10                                                                   1, 2, 3</span></span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a><span class="co">#&gt; 11                                                                      0, 1</span></span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a><span class="co">#&gt; 12                     1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 97</span></span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a><span class="co">#&gt;    na_labels na_range n_labels n_valid_labels n_na_labels</span></span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a><span class="co">#&gt; 1                  NA        3              3           0</span></span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a><span class="co">#&gt; 2                  NA        2              2           0</span></span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a><span class="co">#&gt; 3                  NA       14             14           0</span></span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a><span class="co">#&gt; 4          9       NA        3              2           1</span></span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a><span class="co">#&gt; 5          3       NA        3              2           1</span></span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a><span class="co">#&gt; 6        999       NA        3              2           1</span></span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a><span class="co">#&gt; 7                  NA       21             21           0</span></span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a><span class="co">#&gt; 8          9       NA        4              3           1</span></span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a><span class="co">#&gt; 9         NA       NA        0              0           0</span></span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a><span class="co">#&gt; 10         8       NA        4              3           1</span></span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a><span class="co">#&gt; 11                 NA        2              2           0</span></span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a><span class="co">#&gt; 12                 NA       16             16           0</span></span></code></pre></div>
<p>The current retroharmonize uses the metadata_create() function to
restore the encoded metadata into a tidy table that can be the start of
further steps. This function should be revised after much use, and
brought to a simpler format, and renamed, preferably choosing a DDI
Glossary term. (Ingest? Or just mapping? Should not contain any
tidyverse verbs.) C2: The selected variables from the metadata table
(which needs a better word) we subset the surveys either in memory or,
in case of many files, sequentially from file. This the subset_survey()
function. It will need a thorough upgrade to correctly retain the
attributes of the datacube-inheritted new survey class, but it functions
well.</p>
<p>This stage should be harmonized with the <a href="https://zenodo.org/records/14447460">DDI Codebook</a>. One problem
appears to me is that DDI calls a “codebook” differently than we do. DDI
uses the term codebook on the level of file (survey), and we use it on
the level of individual observations.</p>
<blockquote>
<p>Codebook: A document that provides information on the structure,
contents, and layout of a data file. Source: <a href="https://docs.ddialliance.org/DDI-Codebook/2.5/xmlschema/schemas/codebook_xsd/elements/codeBook.html">DDI
Glossary</a>.</p>
</blockquote>
<p>Here is a DDI Codebook example in <a href="https://ddialliance.org/hubfs/sites/default/files/National%20Household%20Survey,%202011%20%5BCanada%5D%20Public%20Use%20Microdata%20File%20(PUMF)-%20Individuals%20File.pdf">PDF</a>.</p>
<p>Because normally we want to use standardized codes, and we started to
harmonize with the SDMX statistical metadata standard, a good resolution
seems to be to differentiate between a Codebook (DDI term) and a
Codelist (SDMX term, but I am sure it has a more general RDF
definition.)</p>
<p>We roughly have a DDI Codebook regarding the concepts and question
items, but the number of Valid and Invalid responses were not collected
at ingestion:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>example_metadata <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="at">Filename =</span> .data<span class="sc">$</span>filename,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="at">Name =</span> .data<span class="sc">$</span>var_name_orig,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="at">Label =</span> .data<span class="sc">$</span>var_label_orig,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">Type =</span> .data<span class="sc">$</span>class_orig,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="at">Format =</span> .data<span class="sc">$</span>labels</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="at">Valid =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    <span class="at">Invalid =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="at">Question =</span> <span class="cn">NA_character_</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">12</span>)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `&quot;class_orig&quot;` instead of `.data$class_orig`</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once per session.</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; generated.</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `&quot;labels&quot;` instead of `.data$labels`</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once per session.</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; generated.</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt;      Filename     Name                                      Label</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt; 1  ZA7576.rds   caseid            kantar_case_id_country_specific</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; 2  ZA6863.rds   qd7.12 important_values_pers_respect_for_cultures</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="co">#&gt; 3  ZA7576.rds serialid         serial_case_id_appointed_by_kantar</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co">#&gt; 4  ZA6863.rds    qd7.1          important_values_pers_rule_of_law</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; 5  ZA5913.rds   qd3_13           important_values_pers_none_spont</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="co">#&gt; 6  ZA7576.rds       w1      weight_result_from_target_redressment</span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co">#&gt; 7  ZA6863.rds   qd7.14                   important_values_pers_dk</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt; 8  ZA7576.rds    qd6.4   important_values_pers_individual_freedom</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt; 9  ZA7576.rds   qa6b_3   trust_in_institutions_united_nations_tcc</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt; 10 ZA6863.rds    rowid               unique_identifier_in_za_6863</span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="co">#&gt; 11 ZA7576.rds  qa6a_10       trust_in_institutions_european_union</span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt; 12 ZA7576.rds   qa14_1                  european_parliament_trust</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt;                   Type     Format Valid Invalid Question</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt; 1              numeric         NA    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt; 2       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt; 3              numeric         NA    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; 4       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt; 5       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt; 6              numeric         NA    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; 7       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; 8  haven_labelled_spss    0, 1, 9    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a><span class="co">#&gt; 9  haven_labelled_spss 1, 2, 3, 9    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a><span class="co">#&gt; 10           character         NA    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt; 11 haven_labelled_spss 1, 2, 3, 9    NA      NA     &lt;NA&gt;</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt; 12 haven_labelled_spss 1, 2, 3, 9    NA      NA     &lt;NA&gt;</span></span></code></pre></div>
<p>The DDI Codebook is however, a lot more, because it contains
survey-level metadata that we did not use in retroharmonize so far. We
assumed that the user (researcher) did a comparison of sampling methods,
collection modes, etc, which are all part of the DDI Codebook
standard.</p>
<p>It would be very easy to write a codebook_create() function that
would create a partial DDI codebook as a component of a future DDI
Codebook function codebook_create_ddi() and keep working with this.</p>
<p>However, we have a problem, the current, released retroharmonize has
a more complex <code>create_codebook()</code> function. This should be
depracted.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>my_codebook <span class="ot">&lt;-</span> <span class="fu">create_codebook</span>(</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">survey =</span> <span class="fu">read_rds</span>(</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="st">&quot;ZA7576.rds&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>      <span class="at">package =</span> <span class="st">&quot;retroharmonize&quot;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    )</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  )</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="fu">sample_n</span>(my_codebook, <span class="dv">12</span>)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 12</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;    entry id     filename   var_name_orig var_label_orig            val_code_orig</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;                     &lt;chr&gt;        </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;  1    30 ZA7576 ZA7576.rds qa6a_4        trust_in_institutions_po… 1            </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;  2    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         TR82         </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;  3    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         TR41         </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;  4    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         LV005        </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt;  5    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         FR23         </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;  6    30 ZA7576 ZA7576.rds qa6a_4        trust_in_institutions_po… 9            </span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;  7    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         AL033        </span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt;  8    36 ZA7576 ZA7576.rds qa6b_3        trust_in_institutions_un… 3            </span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt;  9    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         EL13         </span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; 10    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         BE35         </span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; 11    12 ZA7576 ZA7576.rds nuts          region_nuts_codes         BE21         </span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt; 12    13 ZA7576 ZA7576.rds d7            marital_status            8            </span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt; # ℹ 6 more variables: val_label_orig &lt;chr&gt;, label_range &lt;chr&gt;,</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt; #   na_range &lt;named list&gt;, n_labels &lt;dbl&gt;, n_valid_labels &lt;dbl&gt;,</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; #   n_na_labels &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div id="reproducible-research-tasks" class="section level2">
<h2>Reproducible research tasks</h2>
<p>The tasks that we do with this information is variable name and
variable label harmonization.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">metadata_create</span>(example_surveys)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>metadata<span class="sc">$</span>var_name_suggested <span class="ot">&lt;-</span> <span class="fu">label_normalize</span>(metadata<span class="sc">$</span>var_name)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>metadata<span class="sc">$</span>var_name_suggested[metadata<span class="sc">$</span>label_orig <span class="sc">==</span> <span class="st">&quot;age_education&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;age_education&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>harmonized_example_surveys <span class="ot">&lt;-</span> <span class="fu">harmonize_var_names</span>(</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">survey_list =</span> example_surveys,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="at">metadata =</span> metadata</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="fu">lapply</span>(harmonized_example_surveys, names)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;rowid&quot;    &quot;doi&quot;      &quot;version&quot;  &quot;uniqid&quot;   &quot;isocntry&quot; &quot;p1&quot;      </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;p3&quot;       &quot;p4&quot;       &quot;nuts&quot;     &quot;d7&quot;       &quot;d8&quot;       &quot;d25&quot;     </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; [13] &quot;d60&quot;      &quot;qa10_3&quot;   &quot;qa10_2&quot;   &quot;qa10_1&quot;   &quot;qa7_4&quot;    &quot;qa7_2&quot;   </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; [19] &quot;qa7_3&quot;    &quot;qa7_1&quot;    &quot;qa7_5&quot;    &quot;qd3_1&quot;    &quot;qd3_2&quot;    &quot;qd3_3&quot;   </span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; [25] &quot;qd3_4&quot;    &quot;qd3_5&quot;    &quot;qd3_6&quot;    &quot;qd3_7&quot;    &quot;qd3_8&quot;    &quot;qd3_9&quot;   </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; [31] &quot;qd3_10&quot;   &quot;qd3_11&quot;   &quot;qd3_12&quot;   &quot;qd3_13&quot;   &quot;qd3_14&quot;   &quot;w1&quot;      </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; [37] &quot;w3&quot;      </span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;rowid&quot;    &quot;doi&quot;      &quot;version&quot;  &quot;uniqid&quot;   &quot;serialid&quot; &quot;isocntry&quot;</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;p1&quot;       &quot;p2&quot;       &quot;p3&quot;       &quot;p4&quot;       &quot;nuts&quot;     &quot;d7&quot;      </span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; [13] &quot;d8&quot;       &quot;d25&quot;      &quot;d60&quot;      &quot;qa14_3&quot;   &quot;qa14_2&quot;   &quot;qa14_1&quot;  </span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt; [19] &quot;qa8a_3&quot;   &quot;qa8a_9&quot;   &quot;qa8b_2&quot;   &quot;qa8a_1&quot;   &quot;qa8a_7&quot;   &quot;qa8a_8&quot;  </span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; [25] &quot;qa8a_2&quot;   &quot;qa8a_5&quot;   &quot;qa8b_1&quot;   &quot;qa8a_4&quot;   &quot;qa8a_6&quot;   &quot;qa8a_10&quot; </span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt; [31] &quot;qa8b_3&quot;   &quot;qd7 1&quot;    &quot;qd7 2&quot;    &quot;qd7 3&quot;    &quot;qd7 4&quot;    &quot;qd7 5&quot;   </span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt; [37] &quot;qd7 6&quot;    &quot;qd7 7&quot;    &quot;qd7 8&quot;    &quot;qd7 9&quot;    &quot;qd7 10&quot;   &quot;qd7 11&quot;  </span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt; [43] &quot;qd7 12&quot;   &quot;qd7 13&quot;   &quot;qd7 14&quot;   &quot;w1&quot;       &quot;w3&quot;       &quot;wex&quot;     </span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;rowid&quot;    &quot;doi&quot;      &quot;version&quot;  &quot;uniqid&quot;   &quot;caseid&quot;   &quot;serialid&quot;</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;isocntry&quot; &quot;p1&quot;       &quot;p2&quot;       &quot;p3&quot;       &quot;p4&quot;       &quot;nuts&quot;    </span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt; [13] &quot;d7&quot;       &quot;d8&quot;       &quot;d25&quot;      &quot;d60&quot;      &quot;qa14_5&quot;   &quot;qa14_3&quot;  </span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt; [19] &quot;qa14_2&quot;   &quot;qa14_4&quot;   &quot;qa14_1&quot;   &quot;qa6a_5&quot;   &quot;qa6a_10&quot;  &quot;qa6b_2&quot;  </span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt; [25] &quot;qa6a_3&quot;   &quot;qa6a_1&quot;   &quot;qa6b_4&quot;   &quot;qa6a_8&quot;   &quot;qa6a_9&quot;   &quot;qa6a_4&quot;  </span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt; [31] &quot;qa6a_2&quot;   &quot;qa6b_1&quot;   &quot;qa6a_6&quot;   &quot;qa6a_7&quot;   &quot;qa6a_11&quot;  &quot;qa6b_3&quot;  </span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co">#&gt; [37] &quot;qd6 1&quot;    &quot;qd6 2&quot;    &quot;qd6 3&quot;    &quot;qd6 4&quot;    &quot;qd6 5&quot;    &quot;qd6 6&quot;   </span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="co">#&gt; [43] &quot;qd6 7&quot;    &quot;qd6 8&quot;    &quot;qd6 9&quot;    &quot;qd6 10&quot;   &quot;qd6 11&quot;   &quot;qd6 12&quot;  </span></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co">#&gt; [49] &quot;qd6 13&quot;   &quot;qd6 14&quot;   &quot;qg1b&quot;     &quot;qg8&quot;      &quot;w1&quot;       &quot;w3&quot;      </span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt; [55] &quot;wex&quot;</span></span></code></pre></div>
<p>There is, however, an important extra step, what the DDI codebook
calls Type and Format matching. This is software/computer language
dependent, but our codebook could easily accommodate this with
containing the generic DDI Codebook</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">Type =</span> <span class="fu">rep</span>(<span class="st">&quot;discrete&quot;</span>, <span class="dv">3</span>),</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">Format =</span> <span class="fu">c</span>(<span class="st">&quot;numeric-1.0&quot;</span>, <span class="st">&quot;numeric-2.0&quot;</span>, <span class="st">&quot;numeric-6.0&quot;</span>),</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">r_type =</span> <span class="fu">rep</span>(<span class="st">&quot;integer&quot;</span>, <span class="dv">3</span>),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">range =</span> <span class="fu">c</span>(<span class="st">&quot;0..9&quot;</span>, <span class="st">&quot;10..99&quot;</span>, <span class="st">&quot;100000..999999&quot;</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Format</th>
<th align="left">r_type</th>
<th align="left">range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-1.0</td>
<td align="left">integer</td>
<td align="left">0..9</td>
</tr>
<tr class="even">
<td align="left">discrete</td>
<td align="left">numeric-2.0</td>
<td align="left">integer</td>
<td align="left">10..99</td>
</tr>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-6.0</td>
<td align="left">integer</td>
<td align="left">100000..999999</td>
</tr>
</tbody>
</table>
<p>These variables can be mapped either to our <a href="https://retroharmonize.dataobservatory.eu/articles/labelled_spss_survey.html">labelled_spss_survey</a>
class or Adrian Dusa’s <a href="https://github.com/dusadrian/declared">declared</a>.</p>
<p>Considerations: - The <em>labelled_spss_survey</em> or
<em>declared</em> is necessary because R does not have a missing case
identifier that can distinguish declined answers or answers that were
not collected. - There must be a clear coercion (without “lazy” and
ambiguous coercion) to at least R integer, numeric, character or factor
classes for further use in R’s statistical functions or visualization
functions. - Integers can easily be coerced into characters, but this is
not necessarily a good idea, because some functions anyway want a
numeric input, and characters require a lot more space to be stored in
memory or in a file.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="dv">1982</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; [1] 1982</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">as.character</span>(<span class="fu">as.integer</span>(<span class="dv">1982</span>))</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1982&quot;</span></span></code></pre></div>
<p>we can assume that we only use integer representation for coded
questionnaire items, but we still may have open text responses or
observation identifiers that are character vectors. It is likely that
the use of character-represented identifiers is a better idea in later
stages. So we must work with a class that can be converted (coerced)
into both integer (numeric) and character formats.</p>
<p>The choice has profound consequences for variable label harmonization
and the harmonization of codelists, but not at the level of concepts,
questions and codebooks.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">Type =</span> <span class="fu">rep</span>(<span class="st">&quot;discrete&quot;</span>, <span class="dv">3</span>),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">Format =</span> <span class="fu">c</span>(<span class="st">&quot;numeric-1.0&quot;</span>, <span class="st">&quot;numeric-2.0&quot;</span>, <span class="st">&quot;numeric-6.0&quot;</span>),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">r_type =</span> <span class="fu">rep</span>(<span class="st">&quot;declared&quot;</span>, <span class="dv">3</span>),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="at">range =</span> <span class="fu">c</span>(<span class="st">&quot;Male|Female|DK&quot;</span>, <span class="st">&quot;10..99&quot;</span>, <span class="st">&quot;100000..999999&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Format</th>
<th align="left">r_type</th>
<th align="left">range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-1.0</td>
<td align="left">declared</td>
<td align="left">Male|Female|DK</td>
</tr>
<tr class="even">
<td align="left">discrete</td>
<td align="left">numeric-2.0</td>
<td align="left">declared</td>
<td align="left">10..99</td>
</tr>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-6.0</td>
<td align="left">declared</td>
<td align="left">100000..999999</td>
</tr>
</tbody>
</table>
</div>
<div id="question-banks" class="section level2">
<h2>Question Banks</h2>
<p>Question banks contain information about questions asked about the
same concepts in different surveys.</p>
<p>“Using DDI as a foundation for a question bank enables you to reuse
metadata and to find identical and similar questions and or response
sets across surveys for purposes of data comparison, harmonization, or
new questionnaire development.”</p>
<p><a href="https://ddialliance.org/create-a-codebook">Create a Question
Bank</a></p>
<p><strong>Social Science Variables Database</strong>: (located at
ICPSR) Search over 4 million variables. Also able to compare questions
across studies and series. <a href="https://www.icpsr.umich.edu/sites/icpsr/find-data" class="uri">https://www.icpsr.umich.edu/sites/icpsr/find-data</a></p>
<p><strong>UK Data Service Variable and Question Bank</strong>: Search
hundreds of surveys. <a href="https://discover.ukdataservice.ac.uk/variables" class="uri">https://discover.ukdataservice.ac.uk/variables</a></p>
<p><strong>Survey Data Netherlands</strong>: Over 36,000 questions to
search. <a href="https://surveydata.nl" class="uri">https://surveydata.nl</a></p>
<p>Obviously we should facilitate the use of existing question banks,
and create question banks that interoperable with existing ones.</p>
<p>Let’s take a look at concerts in the Eurobarometer series. <a href="https://www.icpsr.umich.edu/web/ICPSR/series/26/variables?q=concert" class="uri">https://www.icpsr.umich.edu/web/ICPSR/series/26/variables?q=concert</a>
Here is the variable that we use in our use case: <a href="https://www.icpsr.umich.edu/web/ICPSR/studies/35505/datasets/0001/variables/QB1_4?archive=icpsr" class="uri">https://www.icpsr.umich.edu/web/ICPSR/studies/35505/datasets/0001/variables/QB1_4?archive=icpsr</a></p>
<p>A short caveat: the questionnaire item may or may not be copyright
protected. The reuse of the questionnaire requires further research.</p>
<p>Here we have Values (1…5) and their labels (Not in the last 12
months, 1-2 times, etc)</p>
<ul>
<li>We must clarify with Eurobarometer, Afrobarometer, etc, if we can
reuse their questions in question banks, and are researchers to use it
in harmonized surveys?</li>
</ul>
<p>The question bank information already contains information for the
next step, the harmonization of value labels and codelists not covered
in this vignette.</p>
</div>
<div id="literature-review" class="section level2">
<h2>Literature review</h2>
<ul>
<li>Standard view in the literature on concept and question
harmonization. Any difference with ex ante and ex post
harmonization?</li>
<li>Comparison of the DDI Constructs: Concept, Question — correctly
representing this in our function descriptions and vignettes.</li>
</ul>
</div>
<div id="coding-tasks-conceptcoding" class="section level2">
<h2>Coding tasks {#concept=coding}</h2>
<p>We should follow the <a href="https://devguide.ropensci.org/">rOpenSci Packages: Development,
Maintenance, and Peer Review</a> for future changes. In designing and
deprecating functions, the relevant parts are</p>
<ul>
<li><a href="https://devguide.ropensci.org/building.html#function-and-argument-naming">1.3.1
Function and argument naming</a></li>
<li><a href="https://devguide.ropensci.org/evolution.html">15 Package
evolution - changing stuff in your package</a></li>
</ul>
<ol style="list-style-type: decimal">
<li><code>create_codebook()</code> will be deprecated, luckily, it does
not meet the rOpenSci object_verb suggestion.</li>
<li><code>codebook_create()</code> will create a DDI-Codebook
compatible, partial codebook, only covering tasks that are relevant for
retroharmonize. The core of the codebook will be compatible with
DDI-Codebook, but further information about the R specific
implementation of the codebook will be added.</li>
<li><code>codebook_export_ddi()</code> will add further data (whatever
we have but do not use) to make a more complete, but not necessarily
complete DDI Codebook object. [Not a high priority now.]</li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
