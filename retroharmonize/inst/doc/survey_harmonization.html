<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Survey Harmonization</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Survey Harmonization</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(retroharmonize)</span></code></pre></div>
<p>Survey data harmonization refers to procedures that improve the data
comparability or the inferential capacity of multiple surveys. <em>Ex
ante</em> survey harmonization refers to planning and design steps to
make sure that not yet answered questionnaires can be better compared,
or data derived from them joined, integrated. Such procedures include
the harmonization of the questionnaire, the harmonization of the sample
design, and other aspects of carrying out multiple surveys. <em>Ex
post</em> or <em>retrospective harmonization</em> refers to procedures
to data that has been derived from surveys—i.e., survey that have been
carried out.</p>
<p>Naturally, better <em>ex ante</em> harmonization makes eventual data
integration or data comparison easier; yet often we can still harmonize
retrospectively survey data that has not been carefully pre-harmonized
before respondents have answered the questionnaire items.</p>
<p>Our aim with the <code>retroharmonize</code> R package is to provide
assistance to a reproducible research workflow in carrying out important
computational aspects of retrospective survey harmonization.</p>
<p>Let’s start with a very simple example.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(labelled)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;labelled&#39; was built under R version 4.5.2</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>survey_1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">labelled</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="cn">NA_real_</span>), <span class="fu">c</span>(<span class="at">Male =</span> <span class="dv">1</span>, <span class="at">Female =</span> <span class="dv">0</span>))</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">attr</span>(survey_1, <span class="st">&quot;id&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;Survey 1&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>survey_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">labelled</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="at">male =</span> <span class="dv">1</span>, <span class="at">female =</span> <span class="dv">2</span>, <span class="at">other =</span> <span class="dv">3</span>, <span class="at">declined =</span> <span class="dv">9</span>))</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">attr</span>(survey_2, <span class="st">&quot;id&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;Survey 2&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>survey_1 <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="at">sex_numeric =</span> <span class="fu">as_numeric</span>(.data<span class="sc">$</span>sex),</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">sex_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>sex)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  )</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt;   sex sex_numeric sex_factor</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; 1   1           1       Male</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; 2   1           1       Male</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; 3   0           0     Female</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; 4  NA          NA       &lt;NA&gt;</span></span></code></pre></div>
<div id="tasks-in-the-harmonization-workflow" class="section level2">
<h2>Tasks in the harmonization workflow</h2>
<p>The ordering of the survey harmonization workflow is flexible, and it
is likely that even the same researcher would choose a different
workflow in the case of smaller, simpler harmonization tasks and more
complex harmonization tasks.</p>
<p>The data science aspect of a successful survey harmonization task is
the creation of a consistent data frame that contains harmonized
information from multiple surveys. It practically means that
questionnaire items are mapped into variables with a consistent
numerical coding, descriptive metadata (variable and value labels) and a
consistent handling of missing and special values. This may be very
laborous task when surveys are conducted in different years, saved in
different file formats with a different metadata structure, missing and
special values are handled differently, and the metadata contains
potentially different natural language descriptions or spelling.</p>
<p><code>Survey 1</code> labels the sex of respondents as
<code>Male</code> and <code>Female</code>, and has cases that are
neither <code>Male</code> or <code>Female</code>, but we do not know
why.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>survey_2 <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">gender_numeric =</span> <span class="fu">as_numeric</span>(.data<span class="sc">$</span>gender),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="at">gender_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>gender)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  )</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;   gender gender_numeric gender_factor</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; 1      1              1          male</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; 2      3              3         other</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; 3      9              9      declined</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; 4      1              1          male</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; 5      2              2        female</span></span></code></pre></div>
<p><code>Survey 2</code> records gender, which contains the same
information as sex in <code>Survey 1</code> (<code>Male</code> and
<code>Female</code>), but allows people to identify as
<code>Other</code>, and labels cases when people decline to identify
with any of these three categories.</p>
<p>In practice, you want to end up with the following joined
representation of your survey:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>survey_joined <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">survey =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">5</span>)),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">labelled</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="at">male =</span> <span class="dv">1</span>, <span class="at">female =</span> <span class="dv">0</span>, <span class="at">other =</span> <span class="dv">3</span>, <span class="at">declined =</span> <span class="dv">9</span>))</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>survey_joined <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">paste0</span>(<span class="st">&quot;survey_&quot;</span>, .data<span class="sc">$</span>survey, <span class="st">&quot;_&quot;</span>, .data<span class="sc">$</span>id),</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="at">gender_numeric =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="cn">NA_real_</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="cn">NA_real_</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    <span class="at">gender_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>gender),</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(.data<span class="sc">$</span>gender_numeric <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt;           id survey gender gender_numeric gender_factor is_female</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; 1 survey_1_1      1      1              1          male         0</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; 2 survey_1_2      1      1              1          male         0</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; 3 survey_1_3      1      0              0        female         1</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; 4 survey_1_4      1      9             NA      declined        NA</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; 5 survey_2_1      2      1              1          male         0</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; 6 survey_2_2      2      3              3         other         0</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; 7 survey_2_3      2      9             NA      declined        NA</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; 8 survey_2_4      2      1              1          male         0</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; 9 survey_2_5      2      0              0        female         1</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Harmonization of concepts
<ul>
<li>Create a mental map of the measured concepts that needs to be
harmonized. Which variables contain sufficiently similar information
that can be harmonized? In our simple example, we want to harmonize a
binary sex with missing cases and a four-level categorical variable on
gender identification, and concatenate the harmonized vectors by binding
or joining the Survey 1 and Survey 2 data frames.</li>
<li>Our metadata function help mapping the information stored in the
file representations of multiple surveys. We want to create a simple
inventory of numerical codes, value ranges, missing cases and variable
labels.</li>
</ul></li>
<li>Variable names
<ul>
<li>Data measuring sufficiently similar concepts, i.e. data that can be
harmonized, is stored in variables that have the same name in different
data frames representing the survey, therefore they can be bind or
joined together. We want to join or bind by rows <code>survey_1</code>
with <code>survey_2</code>, or, we want to concatenate
<code>survey_1$sex</code> with <code>survey_2$gender</code>.</li>
<li>Descriptive metadata about the variable, such as “variable labels”
in SPSS files, is recorded for documentation, and if needed, harmonized
across surveys. In SPSSS, <code>survey_1$sex</code> may come with a
variable label something like <em>SEX OF RESPONDENT</em>, and
<code>survey_2$gender</code> may be labelled as <em>GENDER
IDENTIFICATION</em>. This label should be harmonized to <em>Sex or
gender or the respondent</em>.</li>
</ul></li>
<li>Variable coding and labels
<ul>
<li>Variables recording or measuring the same concept, such as the
gender of the respondent, are coded exactly the same way, for example,
females with 0, males with 1, non-binary respondents with 3, and people
declining to reveal their gender with 9. This means that observations in
<code>survey_2$gender</code> coded with a numeric 2 must be changed to a
numeric 0.</li>
<li>Variable labels are used consistently and in exactly the same way,
i.e. <code>survey_1$sex</code> <em>Female</em> respondents and
<code>survey_2$gender</code> <em>female</em> respondents will be
consistently labelled as <em>female</em>.</li>
</ul></li>
<li>Variable types
<ul>
<li>Variables recording or measuring the same concept are stored in
exactly the same R type, and they can be consistently concatenated
across surveys, or they can be subsetted, cross-cutting surveys, for
example, all female respondents from Survey 1 and Survey 2 can be
subsetted into a female vector.</li>
<li>The labelled class of <a href="https://larmarange.github.io/labelled/articles/labelled.html">labelled</a>
is not sufficiently strict, because it allows inconsistent special
(missing) values. Our inherited <a href="https://retroharmonize.dataobservatory.eu/reference/labelled_spss_survey.html">labelled_spss_survey</a>
consistently contains codes, labels, missing ranges and missing values,
and therefore it can be concatenated.</li>
<li>The numeric or factor representation of <code>survey_1$sex</code>
and <code>survey_2$gender</code> can be technically concatenated, but
before harmonization this will create logical errors, because females
will be either coded with 0 or with 2. The <code>as_numeric()</code> and
<code>as_factor()</code> methods of our <a href="https://retroharmonize.dataobservatory.eu/reference/labelled_spss_survey.html">labelled_spss_survey</a>
class handle consistency issues.</li>
</ul></li>
<li>Reproducibility
<ul>
<li>The revision, checking, external review and audit of the data
requires that the steps can be replicated by a third party. This
requires a documentation of the harmonization steps, i.e., 1=Women in
Survey 1, and 0=female in Survey 2 became 0=females in the harmonized
dataset.</li>
<li>Our <a href="https://retroharmonize.dataobservatory.eu/reference/survey.html">survey</a>
class is derived from <a href="https://tibble.tidyverse.org/">tibble</a>, the modernized version
of the base <code>data.frame()</code>. It contains various descriptive
metadata about the survey among attributes.</li>
</ul></li>
</ol>
<p>The joining of the not harmonized datasets results in the following
data frame.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>survey_1 <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="at">survey =</span> <span class="dv">1</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="at">sex_numeric =</span> <span class="fu">as_numeric</span>(.data<span class="sc">$</span>sex),</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="at">sex_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>sex)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    survey_2 <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>        <span class="at">survey =</span> <span class="dv">2</span>,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>        <span class="at">gender_numeric =</span> <span class="fu">as_numeric</span>(.data<span class="sc">$</span>gender),</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>        <span class="at">gender_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>gender)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>      )</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  )</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(survey)`</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt;   sex survey sex_numeric sex_factor gender gender_numeric gender_factor</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 1   1      1           1       Male     NA             NA          &lt;NA&gt;</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 2   1      1           1       Male     NA             NA          &lt;NA&gt;</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; 3   0      1           0     Female     NA             NA          &lt;NA&gt;</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; 4  NA      1          NA       &lt;NA&gt;     NA             NA          &lt;NA&gt;</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; 5  NA      2          NA       &lt;NA&gt;      1              1          male</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; 6  NA      2          NA       &lt;NA&gt;      3              3         other</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; 7  NA      2          NA       &lt;NA&gt;      9              9      declined</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; 8  NA      2          NA       &lt;NA&gt;      1              1          male</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; 9  NA      2          NA       &lt;NA&gt;      2              2        female</span></span></code></pre></div>
<p>Performing only variable harmonization yields to a data frame that
has the correct dimensions, but it is not usable for statistical
analysis.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>survey_var_harmonized <span class="ot">&lt;-</span> survey_1 <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> .data<span class="sc">$</span>sex) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="at">survey =</span> <span class="dv">1</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">gender_numeric =</span> <span class="fu">as_numeric</span>(.data<span class="sc">$</span>gender),</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="at">gender_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>gender)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    survey_2 <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>        <span class="at">survey =</span> <span class="dv">2</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>        <span class="at">gender_numeric =</span> <span class="fu">as_numeric</span>(.data<span class="sc">$</span>gender),</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>        <span class="at">gender_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>gender)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>      ),</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;survey&quot;</span>, <span class="st">&quot;gender_numeric&quot;</span>, <span class="st">&quot;gender_factor&quot;</span>)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  )</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `&quot;sex&quot;` instead of `.data$sex`</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once per session.</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; generated.</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt; Warning: `gender` and `gender` have conflicting value labels.</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; ℹ Labels for these values will be taken from `gender`.</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; ✖ Values: 1</span></span></code></pre></div>
<p>Apart from the simple, descriptive variable of the survey
identification, non of the descriptive statistics are meaningful.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">summary</span>(survey_var_harmonized)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt;      gender         survey      gender_numeric  gender_factor</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.00   Min.   :1.000   Min.   :0.00   Female  :1    </span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:1.00   1st Qu.:1.000   1st Qu.:1.00   Male    :2    </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;  Median :1.00   Median :2.000   Median :1.00   male    :2    </span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;  Mean   :2.25   Mean   :1.556   Mean   :2.25   female  :1    </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:2.25   3rd Qu.:2.000   3rd Qu.:2.25   other   :1    </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;  Max.   :9.00   Max.   :2.000   Max.   :9.00   declined:1    </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;  NA&#39;s   :1                      NA&#39;s   :1      NA&#39;s    :1</span></span></code></pre></div>
<p>The variable labels must be harmonized for a successful factor
representation. The numerical coding must be harmonized, and the missing
cases must be consistently handled to achieve any useful numerical
representation.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>survey_joined <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">paste0</span>(<span class="st">&quot;survey_&quot;</span>, .data<span class="sc">$</span>survey, <span class="st">&quot;_&quot;</span>, .data<span class="sc">$</span>id),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="at">gender_numeric =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="cn">NA_real_</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="cn">NA_real_</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="at">gender_factor =</span> <span class="fu">as_factor</span>(.data<span class="sc">$</span>gender),</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">female_ratio =</span> <span class="fu">ifelse</span>(.data<span class="sc">$</span>gender_numeric <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;       id                survey          gender      gender_numeric</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt;  Length:9           Min.   :1.000   Min.   :0.000   Min.   :0.0   </span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;  Class :character   1st Qu.:1.000   1st Qu.:1.000   1st Qu.:0.5   </span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;  Mode  :character   Median :2.000   Median :1.000   Median :1.0   </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;                     Mean   :1.556   Mean   :2.778   Mean   :1.0   </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;                     3rd Qu.:2.000   3rd Qu.:3.000   3rd Qu.:1.0   </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;                     Max.   :2.000   Max.   :9.000   Max.   :3.0   </span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;                                                     NA&#39;s   :2     </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt;   gender_factor  female_ratio   </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt;  female  :2     Min.   :0.0000  </span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt;  male    :4     1st Qu.:0.0000  </span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt;  other   :1     Median :0.0000  </span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt;  declined:2     Mean   :0.2857  </span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt;                 3rd Qu.:0.5000  </span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt;                 Max.   :1.0000  </span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt;                 NA&#39;s   :2</span></span></code></pre></div>
</div>
<div id="how-we-help-harmonization" class="section level2">
<h2>How we help harmonization</h2>
<ol style="list-style-type: decimal">
<li><p>The <em>data importing</em> functions make sure that survey data
and metadata are carefully translated to R data classes and variable
types.</p></li>
<li><p>The <em>metadata functions</em> help the analysis, normalization
and joining of the metadata aspects (variable and value labels, original
variable names, unique identifiers) across surveys.</p></li>
<li><p><em>Harmonization functions</em> help the harmonization of
responses to questionnaire items, i.e. making sure that coded values,
the labelling of values, and missing data are handled consistently
across multiple surveys.</p></li>
</ol>
<p>Our package was tested on multiple, international, harmonized
surveys, particularly the Eurobarometer, the Afrobarometer and the Arab
Barometer survey programs. Different users, and different task call for
different workflows. We created a number of helper functions to assist
various workflows.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
