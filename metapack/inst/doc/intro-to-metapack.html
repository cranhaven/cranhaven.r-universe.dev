<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Daeyoung Lim" />

<meta name="date" content="2024-01-23" />

<title>Introduction to metapack</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to metapack</h1>
<h4 class="author">Daeyoung Lim</h4>
<h4 class="date">2024-01-23</h4>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<div id="table-of-contents" class="section level3">
<h3>Table of Contents</h3>
<ul>
<li><a href="#meta-data">Meta-analytic data</a></li>
<li><a href="#meta-analyze"><code>bmeta_analyze</code></a>
<ul>
<li><a href="#using-formula">Using <code>Formula</code></a></li>
<li><a href="#arguments">Function arguments</a></li>
</ul></li>
<li><a href="#bayes-parobs">Use case 1 - multivariate
meta-analysis</a></li>
<li><a href="#bayes-nmr">Use case 2 - univariate network
meta-analysis</a></li>
<li><a href="#appx">Appendix: model descriptions</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>
<div id="meta-data" class="section level2">
<h2>Meta-analytic data</h2>
<p>Meta-analytic data is largely characterized in three ways: univariate
or multivariate, meta-analysis or network meta-analysis, and aggregate
data or individual participant data. All other modeling choices fall
into prior specification. For aggregate-data models, the standard data
format is shown in the following table: <a name="table-1"></a></p>
<table>
<colgroup>
<col width="16%" />
<col width="7%" />
<col width="21%" />
<col width="21%" />
<col width="12%" />
<col width="12%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Outcome</th>
<th align="center">Std.Dev</th>
<th align="center">XCovariate</th>
<th align="center">WCovariate</th>
<th align="center">Trial (<code>k</code>)</th>
<th align="center">Treat (<code>t</code>)</th>
<th align="center">Npt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(\bar{y}_{\cdot
13}\)</span></td>
<td align="center"><span class="math inline">\(S_{13}\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{x}_{13}^\top\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{w}_{13}^\top\)</span></td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">1000</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\bar{y}_{\cdot
10}\)</span></td>
<td align="center"><span class="math inline">\(S_{10}\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{x}_{10}^\top\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{w}_{20}^\top\)</span></td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1000</td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\bar{y}_{\cdot
20}\)</span></td>
<td align="center"><span class="math inline">\(S_{20}\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{x}_{20}^\top\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{w}_{20}^\top\)</span></td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1000</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
<p>Outcome is the response(s), Std.Dev is the standard deviation(s) of
the response(s), XCovariate and WCovariate are the design matrices, and
Npt is the trial sample sizes. The pair of trial and treatment
indicators is unique to a specific row. Individual participant data
obviously doesn’t have Std.Dev and Npt.</p>
</div>
<div id="meta-analyze" class="section level2">
<h2><code>bmeta_analyze</code></h2>
<p><code>bmeta_analyze</code> is the main function in
<strong>metapack</strong> that supersedes and subsumes all previous
worker functions. <code>bmeta_analyze</code> internally parses the
formula and identifies the model, which ultimately passes the arguments
to a suitable worker function. The vanilla <strong>formula</strong>
class lacks <em>parts</em> and should strictly have one left-hand side
(LHS) and one right-hand side (RHS). <strong>Formula</strong> <span class="citation">(Zeileis and Croissant 2010)</span> extends this
formula interface to allow multiple parts and multiple responses,
lending itself well into (network) meta-analysis.</p>
<p>Aside from the model-specific arguments, <code>control</code> has two
items universally applicable: <code>scale_x</code> and
<code>verbose</code>. When <code>TRUE</code>, the former standardizes
the fixed-effects design matrix, and the latter allows printing the
progress bar of the Markov chain Monte Carlo algorithm. Both default to
<code>FALSE</code> if not provided. Note that if <code>scale_x</code> is
<code>TRUE</code>, the subsequent methods like <code>print</code>,
<code>summary</code>, or <code>coef</code> will revert the scaling to
their original units. If this behavior is not desired, scale the
variables explicitly in the formula.</p>
<div id="using-formula" class="section level3">
<h3>Using <code>Formula</code></h3>
<p>Each <em>part</em> in LHS or RHS is an R expression where variables
(or functions of variables) are chained with a plus sign
(<code>+</code>), e.g., <code>x1 + x2</code>. The tilde (<code>~</code>)
separates all LHS’s from all RHS’s, each side further broken down into
parts by vertical bars (<code>|</code>). The meaning of each part is
syntactically determined by its location within a formula, like the
English language. Therefore, the order must be observed as presribed for
<code>bmeta_analyze</code> to correctly identify and configure the
model.</p>
<p>Capitalizing on the unique data structure of meta-analysis data, the
general form of the formula is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>y1 <span class="sc">+</span> y2 <span class="sc">|</span> sd1 <span class="sc">+</span> sd2 <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> <span class="fu">ns</span>(n) <span class="sc">|</span> z1 <span class="sc">+</span> z2 <span class="sc">+</span> z3 <span class="sc">|</span> treat <span class="sc">+</span> <span class="fu">trial</span> (<span class="sc">+</span> groups)</span></code></pre></div>
<ul>
<li>The first LHS (<code>y1 + y2</code>), the responses, is required of
all models. Depending on the number of variables given in the first LHS,
the model is either univariate or multivariate.</li>
<li>The second LHS (<code>sd1 + sd2</code>) supplies the standard
deviations of the endpoints required of an aggregate-data meta-analysis.
Currently, with no IPD models implemented, <code>bmeta_analyze</code>
will break if this part is missing; however, in the coming weeks, this
requirement will be relaxed with the introduction of IPD models.</li>
<li>The first RHS (<code>x1 + x2 + x3 + ns(n)</code>) defines the
fixed-effects covariates. For aggregate-data models, the trial sample
sizes must be passed as an argument to <code>ns()</code>. In the example
code, <code>n</code> is the variable containing the trial sample sizes.
IPD models do not have trial samples sizes. In fact,
<code>bmeta_analyze</code> checks the existence of <code>ns()</code> to
determine whether it’s aggregate data.</li>
<li>The second RHS (<code>z1 + z2 + z3</code>) defines either the
random-effects covariates (e.g., <span class="math inline">\(w_{tk}^\top\boldsymbol{\gamma}\)</span>) or the
variance-related covariates (e.g., <span class="math inline">\(\log \tau
= z_{tk}^\top \boldsymbol{\phi}\)</span>)—see <a href="#appx">Appendix</a>.</li>
<li>The third RHS (<code>treat + trial</code> or
<code>treat + trial + groups</code>) corresponds to the treatment and
trial indicators, and optionally the grouping variable if it exists.
Variables here must be provided in the exact order shown in the example.
If variables for this part are not already factors, they are coerced to
extract the levels and number of levels—and <em>unfactored</em>
afterward.</li>
</ul>
</div>
<div id="arguments" class="section level3">
<h3>Function arguments</h3>
<p>Aside from <code>formula</code> and <code>data</code>, there are four
remaining arguments that are required to be lists: <code>prior</code>,
<code>mcmc</code>, <code>control</code>, and <code>init</code>.</p>
<ul>
<li>All prior-related values should be included in
<code>prior</code>.</li>
<li><code>mcmc</code> contains the numbers of Markov chain Monte Carlo
(MCMC) iterations: <code>ndiscard</code> for the number of burn-in
iterations, <code>nskip</code> for thinning, and <code>nkeep</code> for
the posterior sample size.</li>
<li><code>control</code> configures the estimation algorithm. Currently,
the Metropolis-Hastings algorithm is the only estimation method that
allows tuning. <code>*_stepsize</code> with the asterisk replaced with
one of the parameter names indicates the stepsize for determining the
sample evaluation points in the localized Metropolis algorithm.</li>
<li><code>init</code> provides the initial values for the parameters in
case a user has <em>a priori</em> known high-quality starting
values.</li>
</ul>
</div>
</div>
<div id="bayes-parobs" class="section level2">
<h2>Use case 1 - (multivariate) meta-analysis with
<code>bmeta_analyze</code></h2>
<p>Univariate meta-analysis can be specified with one response endpoint
and two treatments, except that the covariance modeling must be
“NoRecovery”.</p>
<p>Multivariate meta-analysis is characterized by multiple response
endpoints and two treatments. Additionally, multivariate meta-analysis
requires a model for the covariance matrix to be specified as
<code>model</code> in the <code>prior</code> argument—which defaults to
<code>model=NoRecovery</code> if left unspecified. The available options
are listed below. The objects parenthesized at the end of every bullet
point are the hyperparameters associated with each model.</p>
<p><a name="model-spec"></a></p>
<ul>
<li><code>model=&quot;NoRecovery&quot;</code> - <span class="math inline">\(\Sigma_{tk} =
\mathrm{diag}(\sigma_{tk,11}^2,\ldots,\sigma_{tk,JJ}^2)\)</span> where
<span class="math inline">\(\sigma_{tk,jj}^2 \sim
\mathcal{IG}(a_0,b_0)\)</span> and <span class="math inline">\(\mathcal{IG}(a,b)\)</span> is <a href="https://en.wikipedia.org/wiki/Inverse-gamma_distribution">the
inverse-gamma distribution</a>. This specification is useful if the user
does not care about the correlation recovery. (<code>c0</code>,
<code>dj0</code>, <code>a0</code>, <code>b0</code>,
<code>Omega0</code>)</li>
<li><code>model=&quot;EquiCovariance&quot;</code> - <span class="math inline">\(\Sigma_{tk}=\Sigma\)</span> for every combination
of <span class="math inline">\((t,k)\)</span> and <span class="math inline">\(\Sigma^{-1}\sim\mathcal{W}_{s_0}(\Sigma_0)\)</span>.
This specification assumes that the user has prior knowledge that the
correlation structure does not change across the arms included.
(<code>c0</code>, <code>dj0</code>, <code>s0</code>,
<code>Omega0</code>, <code>Sigma0</code>)</li>
<li><code>model=&quot;EquiWithinTreat&quot;</code> - <span class="math inline">\(\Sigma_{tk}=\Sigma_t\)</span> and <span class="math inline">\(\Sigma_t^{-1}\sim
\mathcal{W}_{s_0}(\Sigma_0)\)</span>. This is a relaxed version of
<code>model=&quot;EquiCovariance&quot;</code>, allowing the correlation structure
to differ across trials but forcing it to stay identical within a trial.
(<code>c0</code>, <code>dj0</code>, <code>s0</code>,
<code>Omega0</code>, <code>Sigma0</code>)</li>
<li><code>model=&quot;EquiCorrelation&quot;</code> - <span class="math inline">\(\Sigma_{tk}=\boldsymbol{\delta}_{tk}\boldsymbol{\rho}\boldsymbol{\delta}_{tk}\)</span>
where <span class="math inline">\(\boldsymbol{\delta}_{tk}=\mathrm{diag}(\Sigma_{tk,11}^{1/2},\ldots,\Sigma_{tk,JJ}^{1/2})\)</span>,
and <span class="math inline">\(\boldsymbol{\rho}\)</span> is the
correlation matrix. This specification allows the variances to vary
across arms but requires that the correlations be the same. This is due
to the lack of correlation information in the data, which would in turn
lead to the nonidentifiability of the correlations if they were allowed
to vary. However, this still is an ambitious model which permits maximal
degrees of freedom in terms of variance and correlation estimation.
(<code>c0</code>, <code>dj0</code>, <code>a0</code>, <code>b0</code>,
<code>Omega0</code>)</li>
<li><code>model=&quot;Hierarchical&quot;</code> - The fifth model is hierarchical
and thus may require more data than the others: <span class="math inline">\((\Sigma_{tk}^{-1}\mid \Sigma)\sim
\mathcal{W}_{\nu_0}((\nu_0-J-1)^{-1}\Sigma^{-1})\)</span> and <span class="math inline">\(\Sigma \sim \mathcal{W}_{d_0}(\Sigma_0)\)</span>.
<span class="math inline">\(\Sigma_{tk}\)</span> encodes the
within-treatment-arm variation while <span class="math inline">\(\Sigma\)</span> captures the between-treatment-arm
variation. The hierarchical structure allows the “borrowing of strength”
across treatment arms. (<code>c0</code>, <code>dj0</code>,
<code>d0</code>, <code>nu0</code>, <code>Sigma0</code>,
<code>Omega0</code>)</li>
</ul>
<p>The boilerplate code for multivariate meta-analysis is as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">&quot;y1 + y2 | sd1 + sd2 ~ x1 + x2 + x3 + ns(n) | z1 + z2 + z3 | treat + trial + groups&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">bmeta_analyze</span>(<span class="fu">formula</span>(f), <span class="at">data =</span> df,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="at">mcmc =</span> <span class="fu">list</span>(<span class="at">ndiscard =</span> <span class="dv">20000</span>, <span class="at">nskip =</span> <span class="dv">5</span>, <span class="at">nkeep =</span> <span class="dv">10000</span>),</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">model =</span> <span class="st">&quot;NoRecovery&quot;</span>))</span></code></pre></div>
<p>Except <code>model=&quot;NoRecovery&quot;</code>, all else uses
<code>R_stepsize</code> in the <code>control</code> argument. The fourth
option—<code>model=EquiCorrelation</code>—allows sampling <span class="math inline">\(\boldsymbol{\rho}\)</span>. However, researchers
oftentimes have a rough—or concrete—idea about the correlation values,
and therefore fixing <span class="math inline">\(\boldsymbol{\rho}\)</span> makes sense. That edge
case can be accomplished through setting <code>sample_Rho=FALSE</code>
in <code>control</code> and <code>Rho=&lt;some_matrix&gt;</code> in
<code>init</code>. If <code>sample_Rho=FALSE</code> but no initial value
for <code>Rho</code> is given, it will default to 0.5 (<span class="math inline">\(\boldsymbol{\rho}=0.5\boldsymbol{I}+0.5\boldsymbol{1}\boldsymbol{1}^\top\)</span>).
In full form,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>Rho_init <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">3</span>) <span class="co"># assume 3 by 3</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Rho_init[<span class="fu">upper.tri</span>(Rho_init)] <span class="ot">&lt;-</span> </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    Rho_init[<span class="fu">lower.tri</span>(Rho_init)] <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">bmeta_analyze</span>(<span class="fu">formula</span>(f), <span class="at">data =</span> df,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">model =</span> <span class="st">&quot;EquiCorr&quot;</span>), <span class="co"># abbreviation allowed</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">list</span>(<span class="at">sample_Rho =</span> <span class="cn">FALSE</span>),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        <span class="at">init =</span> <span class="fu">list</span>(<span class="at">Rho =</span> Rho_init))</span></code></pre></div>
</div>
<div id="bayes-nmr" class="section level2">
<h2>Use case 2 - univariate network meta-analysis with
<code>bmeta_analyze</code></h2>
<p>Univariate network meta-analysis is characterized by a single
response endpoint and more than two treatments. Similar to
<code>model</code> in the multivariate meta-analysis case, the degrees
of freedom (<code>df</code>) for the random effects’ multivariate <span class="math inline">\(t\)</span>-distribution are the parameter of
interest in univariate network meta-analysis. Objects parenthesized at
the end are the hyperparameters associated with the model.</p>
<ul>
<li><code>df = &lt;positive_real_value&gt;</code> - the random effects
follow a multivariate <span class="math inline">\(t\)</span>-distribution. If <code>df</code> is not
provided by the user, it defaults to 20. (<code>c01</code>,
<code>c02</code>)</li>
<li><code>df = Inf</code> - the random effects follow a multivariate
normal distribution. (<code>c01</code>, <code>c02</code>)</li>
<li><code>sample_df=TRUE</code> in <code>control</code> - the random
effects follow a multivariate <span class="math inline">\(t\)</span>-distribution but the degrees of freedom
are treated as random, in which case a hierarchical prior distribution
is considered for <code>df</code>. That is,
<code>(df | nu_a, nu_b) ~ Ga(nu_a, nu_a / nu_b)</code>,
<code>nu_a ~ Ga(a4, b4)</code>, and <code>nu_b ~ IG(a5, b5)</code>.
(<code>c01</code>, <code>c02</code>, <code>a4</code>, <code>b4</code>,
<code>a5</code>, <code>b5</code>)</li>
</ul>
<p>The boilerplate code for univariate network meta-analysis is as
follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">&quot;y | sd ~ x1 + x2 + x3 + ns(n) | z1 + z2 + z3 | treat + trial&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">bmeta_analyze</span>(<span class="fu">formula</span>(f), <span class="at">data =</span> df,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>        <span class="at">mcmc =</span> <span class="fu">list</span>(<span class="at">discard =</span> <span class="dv">20000</span>, <span class="at">nskip =</span> <span class="dv">5</span>, <span class="at">nkeep =</span> <span class="dv">10000</span>),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">df =</span> <span class="dv">3</span>)) <span class="co"># heavy-tailed random effects</span></span></code></pre></div>
<p>If <code>control=list(sample_df=TRUE)</code>, the <code>df</code>
value in <code>prior</code> is ignored. Identically to the multivariate
meta-analysis case, <code>sample_Rho</code> can be set to
<code>FALSE</code> to suppress the sampling of <code>Rho</code>, and
<code>Rho</code> will be initialized using the corresponding value in
<code>init</code>, which defaults to 0.5 (<span class="math inline">\(\boldsymbol{\rho}=0.5\boldsymbol{I}+0.5\boldsymbol{1}\boldsymbol{1}^\top\)</span>).
The correlation matrix <code>Rho</code> for univariate network
meta-analysis belongs to the random effects, <strong>not</strong> the
responses.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>Rho_init <span class="ot">&lt;-</span> <span class="fu">diag</span>(nT) <span class="co"># nT = the number of treatments</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>Rho_init[<span class="fu">upper.tri</span>(Rho_init)] <span class="ot">&lt;-</span> </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    Rho_init[<span class="fu">lower.tri</span>(Rho_init)] <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">bmeta_analyze</span>(<span class="fu">formula</span>(f), <span class="at">data =</span> df,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">list</span>(<span class="at">sample_df =</span> <span class="cn">TRUE</span>, <span class="at">sample_Rho =</span> <span class="cn">FALSE</span>),</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>        <span class="at">init =</span> <span class="fu">list</span>(<span class="at">Rho =</span> Rho_init))</span></code></pre></div>
<p>Sometimes, there is no covariate information available for modeling
the variances. The second RHS can be a vector of ones, which reduces the
model to have <span class="math inline">\(\mathrm{Var}(\overline{y}_{tk})=\sigma_{tk}^2/n_{tk}
+ \exp(2\phi)\)</span> for every <span class="math inline">\((t,k)\)</span>. Users can simply do without the
second RHS in this case—the second RHS technically exists but is the
treatment and trial configuration. An example formula is as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">&quot;y | sd ~ x1 + x2 + x3 + ns(n) | treat + trial&quot;</span></span></code></pre></div>
</div>
<div id="appx" class="section level2">
<h2>Appendix</h2>
<div id="multivariate-meta-analysis-model" class="section level4">
<h4>Multivariate meta-analysis model</h4>
<p>When there are multiple endpoints, the correlations thereof are
oftentimes unreported. In a meta-regression setting, the correlations
are something we want to know. In the case of subject-level
meta-analyses (where individual participant/patient data are available),
the correlations may only be one function call away. However, for
study-level meta-analyses, the correlations must be estimated, which is
not an easy task. <code>bmeta_analyze</code> provides five different
models to estimate and recover the missing correlations.</p>
<p>Since the aforementioned setting regards the correlations as missing,
the reported data are <span class="math inline">\((\overline{\boldsymbol{y}}_{\cdot tk},
\boldsymbol{s}_{tk}) \in \mathbf{R}^J \times \mathbf{R}^J\)</span> for
the <span class="math inline">\(t\)</span>th treatment arm and <span class="math inline">\(k\)</span>th trial. Every trial out of <span class="math inline">\(K\)</span> trials includes <span class="math inline">\(T\)</span> treatment arms. The sample size of the
<span class="math inline">\(t\)</span>th treatment arm and <span class="math inline">\(k\)</span>th trial is denoted by <span class="math inline">\(n_{tk}\)</span>. If we write <span class="math inline">\(\boldsymbol{x}_{tkj}\in \mathbf{R}^{p_j}\)</span>
to be the treatment-within-trial level regressor corresponding to the
<span class="math inline">\(j\)</span>th response, reflecting the fixed
effects of the <span class="math inline">\(t\)</span>th treatment arm,
and <span class="math inline">\(\boldsymbol{w}_{tkj}\in
\mathbf{R}^{q_j}\)</span> to be the same for the random effects, the
model becomes</p>
<p><span class="math display">\[\begin{equation}\label{eq:reduced-model}
\overline{\boldsymbol{y}}_{\cdot tk} =
\boldsymbol{X}_{tk}\boldsymbol{\beta} +
\boldsymbol{W}_{tk}\boldsymbol{\gamma}_k +
\overline{\boldsymbol{\epsilon}}_{\cdot tk},
\end{equation}\]</span></p>
<p>and <span class="math inline">\((n_{tk}-1)S_{tk} \sim
\mathcal{W}_{n_{tk}-1}(\Sigma_{tk})\)</span> where <span class="math inline">\(\boldsymbol{X}_{tk} =
\mathrm{blockdiag}(\boldsymbol{x}_{tk1}^\top,\boldsymbol{x}_{tk2}^\top,\ldots,\boldsymbol{x}_{tkJ}^\top)\)</span>,
<span class="math inline">\(\boldsymbol{\beta} =
(\boldsymbol{\beta}_1^\top, \cdots,
\boldsymbol{\beta}_J^\top)^\top\)</span>, <span class="math inline">\(\boldsymbol{W}_{tk}=\mathrm{blockdiag}(\boldsymbol{w}_{tk1}^\top,
\ldots,\boldsymbol{w}_{tkJ}^\top)\)</span>, <span class="math inline">\(\boldsymbol{\gamma}_k =
(\boldsymbol{\gamma}_{k1}^\top,\boldsymbol{\gamma}_{k2}^\top,
\ldots,\boldsymbol{\gamma}_{kJ}^\top)^\top\)</span>, <span class="math inline">\(\overline{\boldsymbol{\epsilon}}_{\cdot tk} \sim
\mathcal{N}(\boldsymbol{0}, \Sigma_{tk}/n_{tk})\)</span>, <span class="math inline">\(S_{tk}\)</span> is the full-rank covariance matrix
whose diagonal entries are the observed <span class="math inline">\(\boldsymbol{s}_{tk}\)</span>, and <span class="math inline">\(\mathcal{W}_\nu(\Sigma)\)</span> is the Wishart
distribution with <span class="math inline">\(\nu\)</span> degrees of
freedom and a <span class="math inline">\(J\times J\)</span> scale
matrix <span class="math inline">\(\Sigma\)</span> whose density
function is</p>
<p><span class="math display">\[
f(X\mid \nu,\Sigma) =
\dfrac{1}{2^{J\nu}|\Sigma|^{\nu/2}\Gamma_J(\nu/2)}|X|^{(\nu-J-1)/2}\exp\left(-\dfrac{1}{2}\mathrm{tr}(\Sigma^{-1}X)
\right)I(X\in \mathcal{S}_{++}^J),
\]</span></p>
<p>where <span class="math inline">\(\Gamma_p\)</span> is the
multivariate gamma function defined by</p>
<p><span class="math display">\[
\Gamma_p(z) = \pi^{p(p-1)/4}\prod_{j=1}^p \Gamma[z+(1-j)/2],
\]</span></p>
<p>and <span class="math inline">\(\mathcal{S}_{++}^J\)</span> is the
space of <span class="math inline">\(J\times J\)</span> symmetric
positive definite matrices. The statistical independence of <span class="math inline">\(\overline{\boldsymbol{\epsilon}}_{\cdot
tk}\)</span> and <span class="math inline">\(S_{tk}\)</span> follows
naturally from <a href="https://en.wikipedia.org/wiki/Basu%27s_theorem">the Basu’s
theorem</a>.</p>
<p>The patients can sometimes be grouped by a factor that will generate
disparate random effects. Although an arbitrary number of groups can
exist in theory, <strong>metapack</strong> restricts the number of
groups to two for practicality. Denoting the binary group indicates by
<span class="math inline">\(u_{tk}\)</span> yields</p>
<p><span class="math display">\[
\overline{y}_{\cdot tkj} = \boldsymbol{x}_{tkj}^\top\boldsymbol{\beta} +
(1-u_{tk})\boldsymbol{w}_{tkj}^\top \boldsymbol{\gamma}_{kj}^0 +
u_{tk}\boldsymbol{w}_{tkj}^\top \boldsymbol{\gamma}_{kj}^1 +
\overline{\epsilon}_{\cdot tkj}.
\]</span></p>
<p>The random effects are modeled as <span class="math inline">\(\boldsymbol{\gamma}_{kj}^l
\overset{\text{ind}}{\sim}\mathcal{N}(\boldsymbol{\gamma}_j^{l*},\Omega_j^l)\)</span>
and <span class="math inline">\((\Omega_j^l)^{-1} \sim
\mathcal{W}_{d_{0j}}(\Omega_{0j})\)</span>. Stacking the vectors, <span class="math inline">\(\boldsymbol{\gamma}_k^l =
((\boldsymbol{\gamma}_{k1}^l)^\top, \ldots,
(\boldsymbol{\gamma}_{kJ}^l)^\top)^\top \sim
\mathcal{N}(\boldsymbol{\gamma}^{l*},\Omega^l)\)</span> where <span class="math inline">\(\boldsymbol{\gamma}^{l*} =
((\boldsymbol{\gamma}_{1}^{l*})^\top,\ldots,(\boldsymbol{\gamma}_{J}^{l*})^\top)^\top\)</span>,
<span class="math inline">\(\Omega_j =
\mathrm{blockdiag}(\Omega_j^0,\Omega_j^l)\)</span>, and <span class="math inline">\(\Omega =
\mathrm{blockdiag}(\Omega_1,\ldots,\Omega_J)\)</span> for <span class="math inline">\(l \in \{0,1\}\)</span>. Adopting the non-centered
reparametrization <span class="citation">(Bernardo et al. 2003)</span>,
define <span class="math inline">\(\boldsymbol{\gamma}_{k,o}^l =
\boldsymbol{\gamma}_k^l - \boldsymbol{\gamma}^{l*}\)</span>. Denoting
<span class="math inline">\(\boldsymbol{W}_{tk}^* =
[(1-u_{tk})\boldsymbol{W}_{tk}, u_{tk}\boldsymbol{W}_{tk}]\)</span>,
<span class="math inline">\(\boldsymbol{X}_{tk}^* =
[\boldsymbol{X}_{tk},\boldsymbol{W}_{tk}^*]\)</span>, and <span class="math inline">\(\boldsymbol{\theta} = (\boldsymbol{\beta}^\top,
{\boldsymbol{\gamma}^{0*}}^\top,
{\boldsymbol{\gamma}^{1*}}^\top)^\top\)</span>, the model is written as
follows:</p>
<p><span class="math display">\[
\overline{\boldsymbol{y}}_{\cdot tk} =
\boldsymbol{X}_{tk}^*\boldsymbol{\theta}+\boldsymbol{W}_{tk}^*\boldsymbol{\gamma}_{k,o}
+ \overline{\boldsymbol{\epsilon}}_{\cdot tk},
\]</span> where <span class="math inline">\(\boldsymbol{\gamma}_{k,o} =
((\boldsymbol{\gamma}_{k,o}^0)^\top,
(\boldsymbol{\gamma}_{k,o}^1)^\top)^\top\)</span>. If there is no
grouping in the patients, setting <span class="math inline">\(u_{tk}=0\)</span> for all <span class="math inline">\((t,k)\)</span> reduces the model back to <span class="math inline">\(\eqref{eq:reduced-model}\)</span>.</p>
<p>The conditional distribution of <span class="math inline">\((R_{tk}
\mid V_{tk}, \Sigma_{tk})\)</span> where <span class="math inline">\(R_{tk} =
V_{tk}^{-\frac{1}{2}}S_{tk}V_{tk}^{-\frac{1}{2}}\)</span> and <span class="math inline">\(V_{tk} =
\mathrm{diag}(S_{tk11},\ldots,S_{tkJJ})\)</span> becomes</p>
<p><span class="math display">\[
f(R_{tk}\mid V_{tk},\Sigma_{tk}) \propto
|R_{tk}|^{(n_{tk}-J-2)/2}\exp\left\{-\dfrac{(n_{tk}-1)}{2}\mathrm{tr}\left(V_{tk}^{\frac{1}{2}}\Sigma_{tk}^{-1}V_{tk}^{\frac{1}{2}}R_{tk}
\right) \right\}.
\]</span></p>
</div>
<div id="univariate-network-meta-analysis-model" class="section level4">
<h4>Univariate network meta-analysis model</h4>
<p>Network meta-analysis is an extension of meta-analysis where more
than two treatments are compared. Unlike the traditional meta-analyses
that restrict the number of treatments to be equal across trials,
network meta-analysis allows varying numbers of treatments. This
achieves a unique benefit that two treatments that have not been
compared head-to-head can be assessed as a pair.</p>
<p>Start by denoting the comprehensive list of treatments in all <span class="math inline">\(K\)</span> trials by <span class="math inline">\(\mathcal{T}=\{1,\ldots,T\}\)</span>. It is rarely
the case that all <span class="math inline">\(T\)</span> treatments are
included in the data but we drop the subscripts <span class="math inline">\(t_k\)</span> and replace it with <span class="math inline">\(t\)</span> for notational simplicity. Now,
consider the model</p>
<p><span class="math display">\[\begin{equation}\label{eq:nmr-basic}
\bar{y}_{\cdot tk} = \boldsymbol{x}_{tk}^\top\boldsymbol{\beta} +
\tau_{tk}\gamma_{tk} + \bar{\epsilon}_{\cdot tk}, \quad
\bar{\epsilon}_{\cdot tk} \sim \mathcal{N}(0,\sigma_{tk}^2/n_{tk}),
\end{equation}\]</span> where <span class="math inline">\(\bar{y}_{\cdot
tk}\)</span> is the univariate aggregate response of the <span class="math inline">\(k\)</span>th trial for which treatment <span class="math inline">\(t\)</span> was assigned, <span class="math inline">\(\boldsymbol{x}_{tk}\)</span> is the aggregate
covariate vector for the fixed effects, and <span class="math inline">\(\gamma_{tk}\)</span> is the random effects term.
The observed standard deviation, <span class="math inline">\(s_{tk}^2\)</span> is modeled by</p>
<p><span class="math display">\[
\dfrac{(n_{tk}-1)s_{tk}^2}{\sigma_{tk}^2} \sim \chi_{n_{tk}-1}^2.
\]</span></p>
<p><span class="math inline">\(\tau_{tk}\)</span> in Equation <span class="math inline">\(\eqref{eq:nmr-basic}\)</span> encapsulates the
variance of the random effect for the <span class="math inline">\(t\)</span>th treatment in the <span class="math inline">\(k\)</span>th trial, which is modeled as a
deterministic function of a related covariate. That is,</p>
<p><span class="math display">\[
\log \tau_{tk} = \boldsymbol{z}_{tk}^\top\boldsymbol{\phi},
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{z}_{tk}\)</span> is the
<span class="math inline">\(q\)</span>-dimensional aggregate covariate
vector and <span class="math inline">\(\boldsymbol{\phi}\)</span> is the
corresponding coefficient vector.</p>
<p>For the <span class="math inline">\(k\)</span>th trial, we define a
selection/projection matrix <span class="math inline">\(E_k =
(e_{t_{1k}},e_{t_{2k}},\ldots, e_{t_{T_k k}})\)</span>, where <span class="math inline">\(e_{t_{lk}} = (0,\ldots,1,\ldots,0)^\top\)</span>,
<span class="math inline">\(l=1,\ldots,T_k\)</span>, with <span class="math inline">\(t_{lk}\)</span>th element set to 1 and 0
otherwise, and <span class="math inline">\(T_k\)</span> is the number of
treatments included in the <span class="math inline">\(k\)</span>th
trial. Let the scaled random effects <span class="math inline">\(\boldsymbol{\gamma}_k =
(\gamma_{1k},\ldots,\gamma_{Tk})^\top\)</span>. Then, <span class="math inline">\(\boldsymbol{\gamma}_{k,o}=E_k^\top\boldsymbol{\gamma}_k\)</span>
is the vector of <span class="math inline">\(T_k\)</span>-dimensional
scaled random effects for the <span class="math inline">\(k\)</span>th
trial. The scaled random effects <span class="math inline">\(\boldsymbol{\gamma}_k \sim
t_T(\boldsymbol{\gamma},\boldsymbol{\rho},\nu)\)</span> where <span class="math inline">\(t_T(\boldsymbol{\mu},\Sigma,\nu)\)</span> denotes
a multivariate <span class="math inline">\(t\)</span> distribution with
<span class="math inline">\(\nu\)</span> degrees of freedom, a location
parameter vector <span class="math inline">\(\boldsymbol{\mu}\)</span>,
and a scale matrix <span class="math inline">\(\Sigma\)</span>.</p>
<p>The non-centered reparametrization <span class="citation">(Bernardo
et al. 2003)</span> gives <span class="math inline">\(\boldsymbol{\gamma}_{k,o} =
E_k^\top(\boldsymbol{\gamma}_k - \boldsymbol{\gamma})\)</span>. Then,
with <span class="math inline">\(\bar{\boldsymbol{y}}_k =
(\bar{y}_{kt_{k1}},\ldots,\bar{y}_{kt_{kT_k}})^\top\)</span>, <span class="math inline">\(\boldsymbol{X}_k =
(\boldsymbol{x}_{kt_{k1}},\ldots, \boldsymbol{x}_{kt_{kT_k}})\)</span>,
and <span class="math inline">\(\boldsymbol{Z}_k(\boldsymbol{\phi}) =
\mathrm{diag}(\exp(\boldsymbol{z}_{kt_{k1}}^\top
\boldsymbol{\phi}),\ldots, \exp(\boldsymbol{z}_{kt_{kT_k}}^\top
\boldsymbol{\phi}))\)</span>, the model is recast as</p>
<p><span class="math display">\[
\bar{\boldsymbol{y}}_k = \boldsymbol{X}_k^* \boldsymbol{\theta} +
\boldsymbol{Z}_k(\boldsymbol{\phi}) \boldsymbol{\gamma}_{k,o}  +
\bar{\boldsymbol{\epsilon}}_k,
\]</span> where <span class="math inline">\(\boldsymbol{X}_k^* =
(\boldsymbol{X}_k, E_k^\top)\)</span>, <span class="math inline">\(\boldsymbol{\theta} = (\boldsymbol{\beta}^\top,
\boldsymbol{\gamma}^\top)^\top\)</span>, and <span class="math inline">\(\bar{\boldsymbol{\epsilon}}_k \sim
\mathcal{N}_{T_k}(\boldsymbol{0},\Sigma_k)\)</span>, <span class="math inline">\(\Sigma_k =
\mathrm{diag}(\sigma_{kt_{k1}}^2/n_{kt_{k1}}, \ldots,
\sigma_{kt_{kT_k}}^2/n_{kt_{kT_k}})\)</span>. This allows the random
effects <span class="math inline">\(\boldsymbol{\gamma}_{k,o} \sim
t_{T_k}(\boldsymbol{0},E_k^\top \boldsymbol{\rho}E_k, \nu)\)</span> to
be centered at zero.</p>
<p>Since the multivariate <span class="math inline">\(t\)</span> random
effects are not analytically marginalizable, we represent it as a scale
mixture of normals as follows:</p>
<p><span class="math display">\[
(\boldsymbol{\gamma}_{k,o}\mid \lambda_k) \overset{\text{ind}}{\sim}
\mathcal{N}_{T_k}\left(\boldsymbol{0},
\lambda_k^{-1}(E_k^\top\boldsymbol{\rho}E_k) \right), \quad \lambda_k
\overset{\text{iid}}{\sim}\mathcal{G}a\left(\dfrac{\nu}{2},\dfrac{\nu}{2}
\right),
\]</span> where <span class="math inline">\(\mathcal{G}a(a,b)\)</span>
indicates the gamma distribution with mean <span class="math inline">\(a/b\)</span> and variance <span class="math inline">\(a/b^2\)</span>.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bernardo2003non" class="csl-entry">
Bernardo, JM, MJ Bayarri, JO Berger, AP Dawid, D Heckerman, AFM Smith,
and M West. 2003. <span>“Non-Centered Parameterisations for Hierarchical
Models and Data Augmentation.”</span> In <em>Bayesian Statistics 7:
Proceedings of the Seventh Valencia International Meeting</em>. Vol.
307. Oxford University Press, USA.
</div>
<div id="ref-Formula2010" class="csl-entry">
Zeileis, Achim, and Yves Croissant. 2010. <span>“Extended Model Formulas
in <span>R</span>: Multiple Parts and Multiple Responses.”</span>
<em>Journal of Statistical Software</em> 34 (1): 1–13. <a href="https://doi.org/10.18637/jss.v034.i01">https://doi.org/10.18637/jss.v034.i01</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
